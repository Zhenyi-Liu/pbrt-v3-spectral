
/*
    pbrt source code is Copyright(c) 1998-2016
                        Matt Pharr, Greg Humphreys, and Wenzel Jakob.

    This file is part of pbrt.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

    - Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.

    - Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
    IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
    TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 */


// core/spectrum.cpp*
#include "spectrum.h"
#include <algorithm>

namespace pbrt {

// Spectrum Method Definitions
bool SpectrumSamplesSorted(const Float *lambda, const Float *vals, int n) {
    for (int i = 0; i < n - 1; ++i)
        if (lambda[i] > lambda[i + 1]) return false;
    return true;
}

void SortSpectrumSamples(Float *lambda, Float *vals, int n) {
    std::vector<std::pair<Float, Float>> sortVec;
    sortVec.reserve(n);
    for (int i = 0; i < n; ++i)
        sortVec.push_back(std::make_pair(lambda[i], vals[i]));
    std::sort(sortVec.begin(), sortVec.end());
    for (int i = 0; i < n; ++i) {
        lambda[i] = sortVec[i].first;
        vals[i] = sortVec[i].second;
    }
}

Float AverageSpectrumSamples(const Float *lambda, const Float *vals, int n,
                             Float lambdaStart, Float lambdaEnd) {
    for (int i = 0; i < n - 1; ++i) CHECK_GT(lambda[i + 1], lambda[i]);
    CHECK_LT(lambdaStart, lambdaEnd);
    // Handle cases with out-of-bounds range or single sample only
    if (lambdaEnd <= lambda[0]) return vals[0];
    if (lambdaStart >= lambda[n - 1]) return vals[n - 1];
    if (n == 1) return vals[0];
    Float sum = 0;
    // Add contributions of constant segments before/after samples
    if (lambdaStart < lambda[0]) sum += vals[0] * (lambda[0] - lambdaStart);
    if (lambdaEnd > lambda[n - 1])
        sum += vals[n - 1] * (lambdaEnd - lambda[n - 1]);

    // Advance to first relevant wavelength segment
    int i = 0;
    while (lambdaStart > lambda[i + 1]) ++i;
    CHECK_LT(i + 1, n);

    // Loop over wavelength sample segments and add contributions
    auto interp = [lambda, vals](Float w, int i) {
        return Lerp((w - lambda[i]) / (lambda[i + 1] - lambda[i]), vals[i],
                    vals[i + 1]);
    };
    for (; i + 1 < n && lambdaEnd >= lambda[i]; ++i) {
        Float segLambdaStart = std::max(lambdaStart, lambda[i]);
        Float segLambdaEnd = std::min(lambdaEnd, lambda[i + 1]);
        sum += 0.5 * (interp(segLambdaStart, i) + interp(segLambdaEnd, i)) *
               (segLambdaEnd - segLambdaStart);
    }
    return sum / (lambdaEnd - lambdaStart);
}

RGBSpectrum SampledSpectrum::ToRGBSpectrum() const {
    Float rgb[3];
    ToRGB(rgb);
    return RGBSpectrum::FromRGB(rgb);
}

SampledSpectrum SampledSpectrum::FromRGB(const Float rgb[3],
                                         SpectrumType type) {
    SampledSpectrum r;
    if (type == SpectrumType::Reflectance) {
        // Convert reflectance spectrum to RGB
        if (rgb[0] <= rgb[1] && rgb[0] <= rgb[2]) {
            // Compute reflectance _SampledSpectrum_ with _rgb[0]_ as minimum
            r += rgb[0] * rgbRefl2SpectWhite;
            if (rgb[1] <= rgb[2]) {
                r += (rgb[1] - rgb[0]) * rgbRefl2SpectCyan;
                r += (rgb[2] - rgb[1]) * rgbRefl2SpectBlue;
            } else {
                r += (rgb[2] - rgb[0]) * rgbRefl2SpectCyan;
                r += (rgb[1] - rgb[2]) * rgbRefl2SpectGreen;
            }
        } else if (rgb[1] <= rgb[0] && rgb[1] <= rgb[2]) {
            // Compute reflectance _SampledSpectrum_ with _rgb[1]_ as minimum
            r += rgb[1] * rgbRefl2SpectWhite;
            if (rgb[0] <= rgb[2]) {
                r += (rgb[0] - rgb[1]) * rgbRefl2SpectMagenta;
                r += (rgb[2] - rgb[0]) * rgbRefl2SpectBlue;
            } else {
                r += (rgb[2] - rgb[1]) * rgbRefl2SpectMagenta;
                r += (rgb[0] - rgb[2]) * rgbRefl2SpectRed;
            }
        } else {
            // Compute reflectance _SampledSpectrum_ with _rgb[2]_ as minimum
            r += rgb[2] * rgbRefl2SpectWhite;
            if (rgb[0] <= rgb[1]) {
                r += (rgb[0] - rgb[2]) * rgbRefl2SpectYellow;
                r += (rgb[1] - rgb[0]) * rgbRefl2SpectGreen;
            } else {
                r += (rgb[1] - rgb[2]) * rgbRefl2SpectYellow;
                r += (rgb[0] - rgb[1]) * rgbRefl2SpectRed;
            }
        }
        r *= .94;
    } else if(type == SpectrumType::Illuminant) {
        // Convert illuminant spectrum to RGB
        if (rgb[0] <= rgb[1] && rgb[0] <= rgb[2]) {
            // Compute illuminant _SampledSpectrum_ with _rgb[0]_ as minimum
            r += rgb[0] * rgbIllum2SpectWhite;
            if (rgb[1] <= rgb[2]) {
                r += (rgb[1] - rgb[0]) * rgbIllum2SpectCyan;
                r += (rgb[2] - rgb[1]) * rgbIllum2SpectBlue;
            } else {
                r += (rgb[2] - rgb[0]) * rgbIllum2SpectCyan;
                r += (rgb[1] - rgb[2]) * rgbIllum2SpectGreen;
            }
        } else if (rgb[1] <= rgb[0] && rgb[1] <= rgb[2]) {
            // Compute illuminant _SampledSpectrum_ with _rgb[1]_ as minimum
            r += rgb[1] * rgbIllum2SpectWhite;
            if (rgb[0] <= rgb[2]) {
                r += (rgb[0] - rgb[1]) * rgbIllum2SpectMagenta;
                r += (rgb[2] - rgb[0]) * rgbIllum2SpectBlue;
            } else {
                r += (rgb[2] - rgb[1]) * rgbIllum2SpectMagenta;
                r += (rgb[0] - rgb[2]) * rgbIllum2SpectRed;
            }
        } else {
            // Compute illuminant _SampledSpectrum_ with _rgb[2]_ as minimum
            r += rgb[2] * rgbIllum2SpectWhite;
            if (rgb[0] <= rgb[1]) {
                r += (rgb[0] - rgb[2]) * rgbIllum2SpectYellow;
                r += (rgb[1] - rgb[0]) * rgbIllum2SpectGreen;
            } else {
                r += (rgb[1] - rgb[2]) * rgbIllum2SpectYellow;
                r += (rgb[0] - rgb[1]) * rgbIllum2SpectRed;
            }
        }
        r *= .86445f;
    } else if(type == SpectrumType::Display){
        // Added by TL
        // Use given display primaries to do the conversion.
        // Currently we just use the default lcd-apple display in ISET. The SPD's are hardcoded.
        // In the future we want to be able to load the primaries.
        r = rgb[0]*R + rgb[1]*G + rgb[2]*B;
        
    } else if(type == SpectrumType::Chart){
            // Added by Zhenyi
            // We assgin the selected rgb value with pre-defined SPDs
            if (abs(25-rgb[0]*255)<1) {
                r = eSFRPatch1;
            } else if (abs(33-rgb[0]*255)<1){
                r = eSFRPatch2;
            } else if (abs(43-rgb[0]*255)<1){
                r = eSFRPatch3;
            } else if (abs(52-rgb[0]*255)<1){
                r = eSFRPatch4;
            } else if (abs(62-rgb[0]*255)<1){
                r = eSFRPatch5;
            } else if (abs(72-rgb[0]*255)<1){
                r = eSFRPatch6;
            } else if (abs(84-rgb[0]*255)<1){
                r = eSFRPatch7;
            } else if (abs(95-rgb[0]*255)<1){
                r = eSFRPatch8;
            } else if (abs(106-rgb[0]*255)<1){
                r = eSFRPatch9;
            } else if (abs(118-rgb[0]*255)<1){
                r = eSFRPatch10;
            } else if (abs(130-rgb[0]*255)<1){
                r = eSFRPatch11;
            } else if (abs(143-rgb[0]*255)<1){
                r = eSFRPatch12;
            } else if (abs(155-rgb[0]*255)<1){
                r = eSFRPatch13;
            } else if (abs(169-rgb[0]*255)<1){
                r = eSFRPatch14;
            } else if (abs(184-rgb[0]*255)<1){
                r = eSFRPatch15;
            } else if (abs(196-rgb[0]*255)<1){
                r = eSFRPatch16;
            } else if (abs(211-rgb[0]*255)<1){
                r = eSFRPatch17;
            } else if (abs(224-rgb[0]*255)<1){
                r = eSFRPatch18;
            } else if (abs(239-rgb[0]*255)<1){
                r = eSFRPatch19;
            } else if (abs(255-rgb[0]*255)<1){
                r = eSFRPatch20;
            } else if (abs(186-rgb[0]*255)<1){
                //bg
                r = eSFRBG;
            } else if (abs(0-rgb[0]*255)<1){
                //bg_bd
                r = eSFRBG_BD;
            } else if (abs(99-rgb[0]*255)<1){
                //bg_sq
                r = eSFRBG_SQ;
            }
        // if not in the color list, then do normal rgbRefl2Spectrum
            else{
                if (rgb[0] <= rgb[1] && rgb[0] <= rgb[2]) {
            // Compute reflectance _SampledSpectrum_ with _rgb[0]_ as minimum
            r += rgb[0] * rgbRefl2SpectWhite;
            if (rgb[1] <= rgb[2]) {
                r += (rgb[1] - rgb[0]) * rgbRefl2SpectCyan;
                r += (rgb[2] - rgb[1]) * rgbRefl2SpectBlue;
            } else {
                r += (rgb[2] - rgb[0]) * rgbRefl2SpectCyan;
                r += (rgb[1] - rgb[2]) * rgbRefl2SpectGreen;
            }
        } else if (rgb[1] <= rgb[0] && rgb[1] <= rgb[2]) {
            // Compute reflectance _SampledSpectrum_ with _rgb[1]_ as minimum
            r += rgb[1] * rgbRefl2SpectWhite;
            if (rgb[0] <= rgb[2]) {
                r += (rgb[0] - rgb[1]) * rgbRefl2SpectMagenta;
                r += (rgb[2] - rgb[0]) * rgbRefl2SpectBlue;
            } else {
                r += (rgb[2] - rgb[1]) * rgbRefl2SpectMagenta;
                r += (rgb[0] - rgb[2]) * rgbRefl2SpectRed;
            }
        } else {
            // Compute reflectance _SampledSpectrum_ with _rgb[2]_ as minimum
            r += rgb[2] * rgbRefl2SpectWhite;
            if (rgb[0] <= rgb[1]) {
                r += (rgb[0] - rgb[2]) * rgbRefl2SpectYellow;
                r += (rgb[1] - rgb[0]) * rgbRefl2SpectGreen;
            } else {
                r += (rgb[1] - rgb[2]) * rgbRefl2SpectYellow;
                r += (rgb[0] - rgb[1]) * rgbRefl2SpectRed;
            }
        }
                r *= .94;
                
            }
    } else{
        Error("Spectrum type not recognized when converting from RGB to spectrum.");
    }
    return r.Clamp();
}

SampledSpectrum::SampledSpectrum(const RGBSpectrum &r, SpectrumType t) {
    Float rgb[3];
    r.ToRGB(rgb);
    *this = SampledSpectrum::FromRGB(rgb, t);
}

Float InterpolateSpectrumSamples(const Float *lambda, const Float *vals, int n,
                                 Float l) {
    for (int i = 0; i < n - 1; ++i) CHECK_GT(lambda[i + 1], lambda[i]);
    if (l <= lambda[0]) return vals[0];
    if (l >= lambda[n - 1]) return vals[n - 1];
    int offset = FindInterval(n, [&](int index) { return lambda[index] <= l; });
    CHECK(l >= lambda[offset] && l <= lambda[offset + 1]);
    Float t = (l - lambda[offset]) / (lambda[offset + 1] - lambda[offset]);
    return Lerp(t, vals[offset], vals[offset + 1]);
}

// LCD display from iset (added by TL)
// ---------------------
    
// Multiply the spd's by this number to scale them to energy units (watts).
// Right now they are normalized so that maximum of all three primaries is 1.
const Float lcdApple_scaling = 0.0036649;
    
const Float lcdApple_lambda[nLCDSamples] = {
    380, 384, 388, 392, 396, 400, 404, 408, 412, 416,
    420, 424, 428, 432, 436, 440, 444, 448, 452, 456,
    460, 464, 468, 472, 476, 480, 484, 488, 492, 496,
    500, 504, 508, 512, 516, 520, 524, 528, 532, 536,
    540, 544, 548, 552, 556, 560, 564, 568, 572, 576,
    580, 584, 588, 592, 596, 600, 604, 608, 612, 616,
    620, 624, 628, 632, 636, 640, 644, 648, 652, 656,
    660, 664, 668, 672, 676, 680, 684, 688, 692, 696,
    700, 704, 708, 712, 716, 720, 724, 728, 732, 736,
    740, 744, 748, 752, 756, 760, 764, 768, 772, 776,
    780};

const Float lcdApple_r[nLCDSamples] = {
    0.0009409, 0.0008193, 0.0006222, 0.0005212, 0.0006284, 0.0005460, 0.0004718, 0.0002879, 0.0004510, 0.0005134,
    0.0005590, 0.0006549, 0.0009528, 0.0020401, 0.0036909, 0.0065148, 0.0092515, 0.0098158, 0.0078846, 0.0056099,
    0.0039666, 0.0034034, 0.0030379, 0.0026509, 0.0027049, 0.0029797, 0.0032224, 0.0034826, 0.0033828, 0.0033329,
    0.0034162, 0.0034455, 0.0033678, 0.0032225, 0.0034358, 0.0033830, 0.0034807, 0.0035565, 0.0035482, 0.0033659,
    0.0031710, 0.0028185, 0.0024570, 0.0023510, 0.0024872, 0.0024505, 0.0026917, 0.0037562, 0.0073103, 0.0167680,
    0.0396786, 0.0809373, 0.1346048, 0.1943688, 0.2552830, 0.3079899, 0.3413565, 0.3657160, 0.3771878, 0.3796307,
    0.3803494, 0.3759960, 0.3722257, 0.3707704, 0.3722170, 0.3674389, 0.3589012, 0.3487587, 0.3377808, 0.3211618,
    0.3028858, 0.2867184, 0.2717582, 0.2557675, 0.2374792, 0.2219123, 0.2057315, 0.1900580, 0.1743437, 0.1563624,
    0.1420893, 0.1274833, 0.1133096, 0.0985784, 0.0851018, 0.0732087, 0.0613879, 0.0526339, 0.0458802, 0.0406742,
    0.0374234, 0.0348147, 0.0330748, 0.0312686, 0.0295997, 0.0284227, 0.0262509, 0.0237677, 0.0210726, 0.0191010,
    0.0182178};
    
const Float lcdApple_g[nLCDSamples] = {
    0.0015514, 0.0012510, 0.0007854, 0.0007208, 0.0004997, 0.0006466, 0.0007584, 0.0006984, 0.0003612, 0.0005614,
    0.0005676, 0.0004390, 0.0004697, 0.0008232, 0.0018029, 0.0028136, 0.0038961, 0.0045991, 0.0041170, 0.0032816,
    0.0026328, 0.0025726, 0.0045618, 0.0114655, 0.0293326, 0.0609867, 0.1046459, 0.1542003, 0.2112294, 0.2625326,
    0.3178001, 0.3623629, 0.4049160, 0.4417911, 0.4749737, 0.4999926, 0.5136648, 0.5275285, 0.5359892, 0.5403500,
    0.5439267, 0.5449680, 0.5377520, 0.5226202, 0.4987828, 0.4644664, 0.4308406, 0.3962199, 0.3595184, 0.3213895,
    0.2789215, 0.2376466, 0.2027453, 0.1653357, 0.1292402, 0.0945048, 0.0637750, 0.0436307, 0.0291436, 0.0198327,
    0.0137698, 0.0101310, 0.0081088, 0.0066413, 0.0056604, 0.0046911, 0.0038981, 0.0032120, 0.0029740, 0.0028723,
    0.0026907, 0.0026330, 0.0028959, 0.0034772, 0.0039672, 0.0042650, 0.0054509, 0.0060117, 0.0071183, 0.0079339,
    0.0085939, 0.0092525, 0.0095696, 0.0089927, 0.0084134, 0.0073086, 0.0062235, 0.0055282, 0.0052606, 0.0052111,
    0.0059103, 0.0059199, 0.0071095, 0.0082111, 0.0098739, 0.0103235, 0.0105384, 0.0114251, 0.0111187, 0.0108325,
    0.0111114};

const Float lcdApple_b[nLCDSamples] = {
    0.0011800, 0.0009840, 0.0016656, 0.0014251, 0.0009951, 0.0010298, 0.0007844, 0.0012707, 0.0021296, 0.0053397,
    0.0136999, 0.0327901, 0.0724286, 0.1501065, 0.2915468, 0.5393450, 0.8297501, 1, 0.9284016, 0.7429308,
    0.5574251, 0.4247371, 0.3230414, 0.2487568, 0.2000412, 0.1734847, 0.1573403, 0.1432556, 0.1265524, 0.1113568,
    0.0969670, 0.0801720, 0.0646204, 0.0492740, 0.0339670, 0.0233277, 0.0159376, 0.0116504, 0.0090142, 0.0073095,
    0.0060782, 0.0051240, 0.0043372, 0.0034345, 0.0027567, 0.0022378, 0.0019121, 0.0014460, 0.0011633, 0.0011078,
    0.0010828, 0.0012404, 0.0013303, 0.0011995, 0.0012528, 0.0011549, 0.0014158, 0.0013660, 0.0011246, 0.0012045,
    0.0012194, 0.0011237, 0.0012161, 0.0012666, 0.0013089, 0.0010858, 0.0014817, 0.0018570, 0.0022427, 0.0021877,
    0.0022516, 0.0020548, 0.0023596, 0.0024070, 0.0025221, 0.0022315, 0.0022654, 0.0019890, 0.0019444, 0.0022546,
    0.0021780, 0.0022892, 0.0022233, 0.0021411, 0.0018529, 0.0016050, 0.0014493, 0.0015668, 0.0014586, 0.0017016,
    0.0019710, 0.0019946, 0.0027273, 0.0033025, 0.0059469, 0.0057165, 0.0049073, 0.0065446, 0.0071454, 0.0076060,
    0.0097952};
    
// ---------------------

// eSFR chart reflectance (added by Zhenyi)
// --------------------

const Float eSFRSPD_lambda[nESFRSamples] = {
380,382,384,386,388,390,392,394,396,398,400,402,404,406,408,410,412,414,416,418,420,422,424,426,428,430,
432,434,436,438,440,442,444,446,448,450,452,454,456,458,460,462,464,466,468,470,472,474,476,478,480,482,
484,486,488,490,492,494,496,498,500,502,504,506,508,510,512,514,516,518,520,522,524,526,528,530,532,534,
536,538,540,542,544,546,548,550,552,554,556,558,560,562,564,566,568,570,572,574,576,578,580,582,584,586,
588,590,592,594,596,598,600,602,604,606,608,610,612,614,616,618,620,622,624,626,628,630,632,634,636,638,
640,642,644,646,648,650,652,654,656,658,660,662,664,666,668,670,672,674,676,678,680,682,684,686,688,690,
692,694,696,698,700,702,704,706,708,710,712,714,716,718,720,722,724,726,728,730,732,734,736,738,740,742,
744,746,748,750,752,754,756,758,760,762,764,766,768,770,772,774,776,778,780};

const Float eSFRSPD_p1[nESFRSamples] = {0.0350234893892759,0.0340660983998804,0.0371573464912281,0.0400752351097179,0.0349382288419351,0.0355886478903637,0.0359794230381279,0.0359714285714286,0.0355545454545455,0.0351164797238999,
    0.0347725392886683,0.0350000000000000,0.0357099002302379,0.0339094955489614,0.0343659942363112,0.0344718309859155,0.0350068775790922,0.0353288135593220,0.0350470430107527,0.0347543160690571,
    0.0351372549019608,0.0354813863928113,0.0353044569993723,0.0350556242274413,0.0354645476772616,0.0352980535279805,0.0355325623858795,0.0355454545454546,0.0351842900302115,0.0352469879518072,
    0.0352581032412965,0.0358099222952779,0.0357832042882668,0.0351251489868892,0.0351785714285714,0.0351787842669845,0.0348867699642432,0.0348210023866348,0.0350268656716418,0.0357228195937873,
    0.0358328358208955,0.0359107142857143,0.0357159833630422,0.0361342042755344,0.0364289958407605,0.0371479713603819,0.0371462974111981,0.0373696969696970,0.0377818403412553,0.0385591661557327,
    0.0393341553637485,0.0396712158808933,0.0400686641697878,0.0413425345043915,0.0411509433962264,0.0424700693131695,0.0430808080808081,0.0440696202531646,0.0444711842938569,0.0451174603174603,
    0.0443571880937302,0.0447281921618205,0.0453409090909091,0.0456313131313131,0.0449526216045483,0.0440482233502538,0.0440025412960610,0.0445454545454546,0.0442711648631445,0.0437523931078494,
    0.0438189987163030,0.0432901554404145,0.0429607843137255,0.0427374670184697,0.0426014637391883,0.0426644295302013,0.0421665538253216,0.0425339673913044,0.0423035230352304,0.0417912457912458,
    0.0420961281708945,0.0419246031746032,0.0409299279633268,0.0402973497091144,0.0405615826419911,0.0403896920175990,0.0402040816326531,0.0397872340425532,0.0394491017964072,0.0396167452830189,
    0.0395449241540257,0.0390283400809717,0.0386981566820277,0.0385340314136126,0.0390615660490138,0.0389526184538653,0.0384550743374273,0.0383606557377049,0.0384756898817346,0.0387343441001978,
    0.0390763052208835,0.0390663900414938,0.0384370477568741,0.0376923076923077,0.0390000000000000,0.0395891472868217,0.0395316159250586,0.0394048551292091,0.0400859375000000,0.0393307392996109,
    0.0397676219984508,0.0392046332046332,0.0388743253662298,0.0401621621621622,0.0398833592534992,0.0388602654176425,0.0395379796397807,0.0399137931034483,0.0396936370777690,0.0386403162055336,
    0.0392338387869114,0.0396854838709677,0.0394535073409462,0.0388235294117647,0.0392080876158383,0.0386507258753202,0.0393067590987868,0.0388312829525483,0.0394017857142857,0.0384043517679057,
    0.0392752293577982,0.0406035283194058,0.0398026315789474,0.0395247148288973,0.0406130268199234,0.0392678227360308,0.0397577519379845,0.0423563777994158,0.0415609756097561,0.0412585365853659,
    0.0416066212268744,0.0425800193986421,0.0427675988428158,0.0421183206106870,0.0418164616840114,0.0435955056179775,0.0437790157845868,0.0430530164533821,0.0437093862815885,0.0455971479500891,
    0.0462620932277924,0.0439982653946227,0.0450428816466552,0.0435708227311281,0.0449874266554904,0.0459354304635762,0.0445327868852459,0.0447149837133551,0.0450363783346807,0.0431400966183575,
    0.0452163461538462,0.0459487590072058,0.0460448358686950,0.0450039968025580,0.0431275060144346,0.0436414790996785,0.0427199354317998,0.0454288025889968,0.0455239642567019,0.0434150326797386,
    0.0463800163800164,0.0466776045939295,0.0451854905193735,0.0471665285832643,0.0460865945045795,0.0446263643996641,0.0450422297297297,0.0484503424657534,0.0476190476190476,0.0475174825174825,
    0.0503436123348018,0.0530158730158730,0.0534942932396839,0.0555905511811024,0.0529370629370629,0.0597731239092496,0.0564644714038128,0.0561312607944732,0.0626992287917738,0.0615436810856658,
    0.0634239592183517,0.0644030482641829,0.0666834170854271,0.0665494137353434,0.0709393183707398,0.0661735537190083,0.0659410801963994,0.0562550771730301,0.0655064308681672,0.0651713147410359,
    0.0635066981875493};

const Float eSFRSPD_p2[nESFRSamples] =
    {0.0333688699360341,0.0322202313080306,0.0332494075829384,0.0348014636129557,0.0342697327532629,0.0350707628581291,0.0363889782352310,0.0368442292171106,0.0375190839694657,0.0381990950226244,
    0.0364365832614323,0.0399751449875725,0.0399048374306106,0.0408938120702827,0.0414444444444444,0.0409978308026030,0.0411963406052076,0.0425984796129924,0.0414900888585099,0.0416048550236008,
    0.0428410596026490,0.0428719948018194,0.0425984752223634,0.0427357901311680,0.0435965453423812,0.0437928921568628,0.0435639926515615,0.0436396835057821,0.0436121212121212,0.0435042219541616,
    0.0436352729454109,0.0440274463007160,0.0451068883610451,0.0439501779359431,0.0446094674556213,0.0446686390532544,0.0444943820224719,0.0439739798935541,0.0442282672974571,0.0440578854105139,
    0.0440200708382527,0.0441470588235294,0.0433587338804220,0.0437338804220399,0.0441138497652582,0.0437573616018846,0.0442840166369578,0.0443387193297427,0.0449187236604455,0.0447941888619855,
    0.0449878197320341,0.0458909981628904,0.0461258482418260,0.0473403595784253,0.0471366459627329,0.0475965130759651,0.0487632729544035,0.0486929330831770,0.0491410658307210,0.0496922110552764,
    0.0494918444165621,0.0502882205513784,0.0511716791979950,0.0507075767063244,0.0500627352572146,0.0501197227473220,0.0503095388502843,0.0506072106261860,0.0498225602027883,0.0499936427209155,
    0.0498017902813299,0.0490961910910265,0.0491406250000000,0.0489027595269383,0.0486944996686547,0.0486515353805073,0.0489427609427610,0.0486959459459460,0.0487929871881322,0.0484919571045576,
    0.0480265780730897,0.0477616853192890,0.0475455729166667,0.0472411575562701,0.0465821179454661,0.0462476547842402,0.0459938461538462,0.0453874092009685,0.0448985680190931,0.0446705882352941,
    0.0443372093023256,0.0438927335640138,0.0441839080459770,0.0436004645760743,0.0435697258641240,0.0436662531017370,0.0438471419396275,0.0440339425587467,0.0439502943100065,0.0434734077478661,
    0.0436708860759494,0.0437345254470426,0.0439655172413793,0.0434454409566517,0.0434756097560976,0.0440461538461538,0.0438574748257165,0.0443545878693624,0.0437791601866252,0.0436046511627907,
    0.0438794435857805,0.0433102386451116,0.0434742505764796,0.0438135593220339,0.0442414860681115,0.0437091757387247,0.0442556508183944,0.0446728971962617,0.0443613707165109,0.0447768206734534,
    0.0457379636937648,0.0460111464968153,0.0462801932367150,0.0456897959183674,0.0464900662251656,0.0471560402684564,0.0472217502124044,0.0466036113499570,0.0470305676855895,0.0465840707964602,
    0.0463831692032229,0.0475362318840580,0.0477584629460201,0.0490900649953575,0.0488317757009346,0.0482768361581921,0.0486527514231499,0.0482156488549618,0.0474233716475096,0.0477224880382775,
    0.0480574162679426,0.0486437440305635,0.0477238095238095,0.0485052034058657,0.0489681050656660,0.0488826815642458,0.0475438596491228,0.0497174111212397,0.0495942290351668,0.0489403383793411,
    0.0493760984182777,0.0494020797227036,0.0497766323024055,0.0505937234944869,0.0505113160100587,0.0502238805970149,0.0509433962264151,0.0515040650406504,0.0513640032284100,0.0515020080321285,
    0.0505195843325340,0.0502555910543131,0.0513258785942492,0.0512887828162291,0.0509170653907496,0.0528252194732642,0.0521537229783827,0.0534109149277689,0.0537560581583199,0.0531987075928918,
    0.0533844911147011,0.0536901865369019,0.0582654723127036,0.0580573770491803,0.0586759868421053,0.0594623655913979,0.0596924355777224,0.0603713080168776,0.0594539249146758,0.0621526586620926,
    0.0615271786022433,0.0630742659758204,0.0632330180567498,0.0661015490533563,0.0667896995708154,0.0652099400171380,0.0705811965811966,0.0689745762711864,0.0716666666666667,0.0691673675357443,
    0.0706438127090301,0.0734525790349418,0.0725477178423237,0.0759983429991715,0.0787262200165426,0.0787911184210526,0.0835893290218270,0.0730378726833199,0.0754363490792634,0.0792586750788644,
    0.0775453827940016};

const Float eSFRSPD_p3[nESFRSamples] = {0.0359038737446198,0.0384993446920052,0.0387039502885042,0.0403121636167923,0.0387985602581606,0.0384916072660382,0.0400128589798543,0.0420179056432954,0.0434574976122254,0.0440198735320687,
    0.0437219343696028,0.0455555555555556,0.0468391719745223,0.0472469325153374,0.0479628252788104,0.0482259232440261,0.0489414255469301,0.0503469812630118,0.0502397260273973,0.0502905405405405,
    0.0506374501992032,0.0506319218241042,0.0507461734693878,0.0514043887147335,0.0509900990099010,0.0512992610837438,0.0524184615384615,0.0521555419473362,0.0524070688604509,0.0529247572815534,
    0.0532951116475558,0.0533913565426170,0.0528922155688623,0.0539724385859796,0.0540107591153616,0.0540490430622010,0.0538865671641791,0.0537253731343284,0.0538842482100239,0.0537268932617770,
    0.0542346634901727,0.0542323651452282,0.0545357776463631,0.0544148936170213,0.0548224852071006,0.0552522255192878,0.0554610778443114,0.0554073627036814,0.0558434466019418,0.0559193646915089,
    0.0562346437346437,0.0563597033374536,0.0564281269446173,0.0562960649594004,0.0571696931747026,0.0578481806775408,0.0583144654088050,0.0578247162673392,0.0587184343434344,0.0582151898734177,
    0.0585831752055661,0.0587247474747475,0.0588825757575758,0.0588832807570978,0.0583438685208597,0.0583862770012706,0.0587523870146404,0.0573915816326531,0.0573465473145780,0.0571905067350866,
    0.0568495803744351,0.0564648437500000,0.0561103810775296,0.0563262599469496,0.0565953177257525,0.0561699258260283,0.0564601769911504,0.0561748633879781,0.0568596730245232,0.0565741367637102,
    0.0562953020134228,0.0562898936170213,0.0561118421052632,0.0551233766233766,0.0548399487836108,0.0542055485498109,0.0535940409683426,0.0531421598535693,0.0524804804804805,0.0526642984014210,
    0.0521006436512580,0.0516889146836912,0.0514219653179191,0.0512310385064177,0.0515508982035928,0.0516137071651090,0.0517635658914729,0.0523556430446194,0.0517159763313609,0.0517821782178218,
    0.0517525083612040,0.0516494133885438,0.0521645021645022,0.0520736288504884,0.0529547198772065,0.0521577726218098,0.0519266770670827,0.0518637431480031,0.0523275862068966,0.0522031250000000,
    0.0522759158222915,0.0521911421911422,0.0521877424359969,0.0520295489891135,0.0515925058548009,0.0515777080062794,0.0519905586152636,0.0514296936370778,0.0518489378442172,0.0518102766798419,
    0.0522213375796178,0.0518810289389068,0.0525649350649351,0.0533552631578947,0.0537145242070117,0.0531699070160609,0.0541181506849315,0.0535559410234172,0.0535827464788732,0.0545276292335116,
    0.0545446348061317,0.0531843065693431,0.0544506001846722,0.0541308411214953,0.0539736346516008,0.0557305502846300,0.0562690839694656,0.0562343900096061,0.0555255544840887,0.0561196911196911,
    0.0578825794032724,0.0576730769230769,0.0600957854406130,0.0579657794676806,0.0575094339622642,0.0590832553788587,0.0581910946196661,0.0566239707227813,0.0580831826401447,0.0567828418230563,
    0.0564134275618375,0.0566870095902354,0.0572437553832903,0.0564425531914894,0.0575546218487395,0.0561078838174274,0.0587489711934156,0.0591510204081633,0.0565287915652879,0.0569057211925866,
    0.0583319967923015,0.0574198717948718,0.0583520000000000,0.0571702637889688,0.0586057692307692,0.0577724358974359,0.0601045016077170,0.0617122186495177,0.0626030719482619,0.0623967611336032,
    0.0625790754257908,0.0656688417618271,0.0685409836065574,0.0676233552631579,0.0692543496271748,0.0703080766028310,0.0717991631799163,0.0730853761622992,0.0741146278870830,0.0722605694564280,
    0.0757068516912403,0.0776086956521739,0.0745217391304348,0.0808124459809853,0.0796041308089501,0.0805349439171700,0.0845726495726496,0.0870638297872341,0.0859322033898305,0.0900083963056255,
    0.0923076923076923,0.0891014975041597,0.0919635459817730,0.0956953642384106,0.0871287128712871,0.0932951757972200,0.0876413570274637,0.0960355987055016,0.0922891566265060,0.0938193343898574,
    0.0897798742138365};

const Float eSFRSPD_p4[nESFRSamples] = {0.0506745202356071,0.0470739660202506,0.0464665415884928,0.0473691674939725,0.0487341772151899,0.0495992343581768,0.0501554174067496,0.0505255489645124,0.0524212598425197,0.0523354958294717,
    0.0506525573192240,0.0521386306001691,0.0535517799352751,0.0546614785992218,0.0551693002257336,0.0567472527472527,0.0577279202279202,0.0576030747728861,0.0581336088154270,0.0585278154681140,
    0.0595466666666667,0.0590986283474853,0.0601277139208174,0.0609290646578782,0.0604829721362229,0.0602953846153846,0.0607182320441989,0.0617073170731707,0.0619393939393939,0.0623869801084991,
    0.0620730976632714,0.0628350208457415,0.0627741553052756,0.0629213483146068,0.0627728613569322,0.0632881555686506,0.0630588235294118,0.0631609870740306,0.0631455399061033,0.0637536656891496,
    0.0633489461358314,0.0630320699708455,0.0633352701917490,0.0633410672853828,0.0634358676726640,0.0639067055393586,0.0635936582501468,0.0637655417406750,0.0643240023823705,0.0639904134212103,
    0.0645783132530121,0.0650090964220740,0.0656497864551556,0.0655024509803922,0.0659090909090909,0.0668103448275862,0.0672424429364590,0.0676361386138614,0.0681536555142503,0.0687577639751553,
    0.0688626476072095,0.0690062111801242,0.0687150837988827,0.0685909373060211,0.0684079601990050,0.0676250000000000,0.0674608150470219,0.0668969849246231,0.0661209068010076,0.0657612128869236,
    0.0649301143583227,0.0649550706033376,0.0647249190938511,0.0648237597911227,0.0646346280447663,0.0652952886529529,0.0653918285331547,0.0656711409395973,0.0655592766242465,0.0654690618762475,
    0.0653856295319710,0.0650816459830176,0.0647286821705426,0.0642219387755102,0.0633563796354494,0.0623915737298637,0.0620268620268620,0.0612612612612613,0.0605917159763314,0.0604434072345391,
    0.0604731679169071,0.0601030337721809,0.0598402738163149,0.0603339090385723,0.0603427895981088,0.0607744314689613,0.0609541984732824,0.0612798965740142,0.0609987029831388,0.0613029315960912,
    0.0614606741573034,0.0621745057941377,0.0614580369843528,0.0612805329385640,0.0611253776435045,0.0612642802741813,0.0614274750575595,0.0616486902927581,0.0619106317411402,0.0613702848344881,
    0.0613517665130568,0.0612720306513410,0.0614231063504208,0.0605819295558959,0.0613317936874519,0.0608416988416988,0.0603016241299304,0.0615366795366795,0.0606563706563707,0.0614252517428350,
    0.0617096018735363,0.0618754925137904,0.0625238853503185,0.0634327155519742,0.0632598039215686,0.0633416046319272,0.0642677824267782,0.0637563451776650,0.0644501718213058,0.0648653344917463,
    0.0652464788732394,0.0655782918149466,0.0660341726618705,0.0665328467153285,0.0674333026678933,0.0679610750695088,0.0686074766355140,0.0693984962406015,0.0696786389413989,0.0697535545023697,
    0.0697821969696970,0.0688920454545455,0.0692917847025496,0.0712593984962406,0.0704108309990663,0.0706672845227062,0.0699633027522936,0.0706272727272727,0.0695777178796047,0.0689431616341030,
    0.0691411042944785,0.0695663486556808,0.0684417808219178,0.0683079526226734,0.0678762541806020,0.0684640792733278,0.0672481572481573,0.0678363047001621,0.0670313757039421,0.0676714513556619,
    0.0683796664019063,0.0684718923198733,0.0684123222748815,0.0700236406619385,0.0684239558707644,0.0677996845425868,0.0693838862559242,0.0699683544303798,0.0723809523809524,0.0712599681020734,
    0.0718189102564103,0.0739760000000000,0.0760465116279070,0.0786370967741936,0.0781265206812652,0.0786074918566775,0.0832379394930499,0.0835264900662252,0.0837228714524207,0.0843206751054852,
    0.0910169491525424,0.0916737468139337,0.0914188615123195,0.0926994906621392,0.0941821247892074,0.0978242677824268,0.100083682008368,0.102159468438538,0.100912863070539,0.101741293532338,
    0.0973619126133553,0.101480263157895,0.101479046836483,0.103911980440098,0.101457489878543,0.101538461538462,0.109090909090909,0.107262569832402,0.101584786053883,0.105481597494127,
    0.104199066874028};

const Float eSFRSPD_p5[nESFRSamples] = {0.0554266777133389,0.0539583649901231,0.0551233793391886,0.0561704834605598,0.0586590217645682,0.0601812424937220,0.0596033936420321,0.0594889103182257,0.0616069788797062,0.0614298169136879,
    0.0618462823725982,0.0625362318840580,0.0624825446082234,0.0640284005979073,0.0651924473493101,0.0665578424414478,0.0668650519031142,0.0678020477815700,0.0685097774780850,0.0680666666666667,
    0.0688073394495413,0.0695624195624196,0.0697732997481108,0.0700928792569660,0.0701163502755665,0.0702010968921389,0.0712195121951220,0.0709599027946537,0.0707272727272727,0.0711782477341390,
    0.0721419975932611,0.0723187537447574,0.0716676628810520,0.0718731298623579,0.0715053763440860,0.0718899521531101,0.0720860729228930,0.0723849372384937,0.0719665271966527,0.0729228930065750,
    0.0727001194743130,0.0721428571428572,0.0717171717171717,0.0721661721068249,0.0724137931034483,0.0737470167064439,0.0729843561973526,0.0739393939393939,0.0739475289810860,0.0742331288343558,
    0.0747686613201727,0.0759925558312655,0.0762648344784510,0.0773383553044570,0.0782252989301448,0.0792559899117276,0.0797092288242731,0.0808739708676377,0.0818757921419518,0.0826142131979696,
    0.0830798479087452,0.0835338822039265,0.0836386607706886,0.0833333333333333,0.0832490518331226,0.0825921219822109,0.0817834394904459,0.0808035714285714,0.0794380587484036,0.0790786948176584,
    0.0782860824742268,0.0779440468445023,0.0774786605384110,0.0772034459907223,0.0772423025435074,0.0769386378961564,0.0773623385452073,0.0777322404371585,0.0776718856364874,0.0773495605138607,
    0.0771294433266264,0.0765292553191490,0.0762500000000000,0.0747724317295189,0.0738629083920564,0.0726813880126183,0.0718187461204221,0.0705308114704088,0.0697897897897898,0.0694855115316381,
    0.0696668614845120,0.0698146002317497,0.0697808535178777,0.0700988947062246,0.0700119474313023,0.0708592777085928,0.0713363460296966,0.0719528178243775,0.0726854891661195,0.0731884057971015,
    0.0738142952571810,0.0741200828157350,0.0738250180766450,0.0747701582516956,0.0747772657450077,0.0751860465116279,0.0753088350273651,0.0755965463108320,0.0744479248238058,0.0754254488680718,
    0.0744591439688716,0.0748369565217391,0.0749650892164469,0.0756410256410256,0.0734296875000000,0.0745447409733124,0.0740361919748230,0.0741889763779528,0.0746608832807571,0.0742936507936508,
    0.0738270616493195,0.0737348423605497,0.0739247751430908,0.0736650082918740,0.0738047138047138,0.0742625745950554,0.0745021645021645,0.0738245614035088,0.0738537020517395,0.0737918552036199,
    0.0740805123513266,0.0757553290083411,0.0769793621013133,0.0758901515151515,0.0772944550669216,0.0776515880654475,0.0784235976789168,0.0795335276967930,0.0799707887049659,0.0809064327485380,
    0.0818190661478599,0.0804166666666667,0.0829054054054054,0.0836111111111111,0.0835768500948767,0.0845872420262664,0.0857342007434944,0.0859157509157509,0.0836889692585895,0.0825691347011597,
    0.0830687830687831,0.0834086956521739,0.0837339055793991,0.0829651656754460,0.0831486146095718,0.0830985915492958,0.0820689655172414,0.0810821806346623,0.0822150363783347,0.0818694601128123,
    0.0812851405622490,0.0809943865276664,0.0811396468699840,0.0818619582664527,0.0795421686746988,0.0827697262479871,0.0805735056542811,0.0819433198380567,0.0833333333333333,0.0888979591836735,
    0.0854337152209493,0.0861955628594906,0.0869421487603306,0.0888704318936877,0.0887218045112782,0.0914357682619647,0.0908783783783784,0.0928327645051194,0.0947322970639033,0.0988626421697288,
    0.102559576345984,0.106084656084656,0.103778558875220,0.109850483729112,0.110994764397906,0.112326388888889,0.116521739130435,0.119480519480519,0.125000000000000,0.125571549534293,
    0.131239388794567,0.134206081081081,0.132830820770519,0.136204013377926,0.138967527060783,0.140924092409241,0.139704675963905,0.137550689375507,0.139856801909308,0.143567482241515,
    0.139828526890101};

const Float eSFRSPD_p6[nESFRSamples] = {0.0639405903365294,0.0647849005271212,0.0644911846582122,0.0722261088568630,0.0697020292833291,0.0695156695156695,0.0705811004520895,0.0706885856079405,0.0715024390243902,0.0726243093922652,
    0.0728157894736842,0.0744705882352941,0.0751566265060241,0.0775289575289575,0.0788059701492537,0.0797385620915033,0.0798022598870057,0.0818307905686547,0.0820670773442847,0.0834231805929919,
    0.0840052875082617,0.0845554834523037,0.0852157360406092,0.0849750623441397,0.0853013530135301,0.0861331704337202,0.0857404021937843,0.0864406779661017,0.0871161950632149,0.0876122082585278,
    0.0885714285714286,0.0886457717327026,0.0889346674514420,0.0887125220458554,0.0891559202813599,0.0891686182669789,0.0895382817066043,0.0898948598130841,0.0903677758318739,0.0896330809551543,
    0.0907504363001745,0.0911884057971015,0.0909826589595376,0.0912189485846332,0.0920277296360485,0.0917101449275362,0.0926315789473684,0.0931644077784325,0.0933056872037915,0.0936271590232281,
    0.0938286399041342,0.0953614457831325,0.0961141469338191,0.0976234003656307,0.0985339034819792,0.100490196078431,0.101842751842752,0.102400000000000,0.103575832305795,0.104885590599876,
    0.105627705627706,0.106053119209389,0.105185185185185,0.104074074074074,0.103957946815090,0.102864259028643,0.101371571072319,0.100000000000000,0.0987476518472135,0.0978656622724419,
    0.0963360707517372,0.0952776005105297,0.0953024453024453,0.0949350649350649,0.0946954813359529,0.0950560316413975,0.0960079840319361,0.0965287049399199,0.0967376830892144,0.0966931216931217,
    0.0966579292267366,0.0959117456197274,0.0954457985888390,0.0941064638783270,0.0925625000000000,0.0910659272951325,0.0898120072771377,0.0885441527446301,0.0875367430922986,0.0869489559164733,
    0.0864601262191624,0.0866249288560046,0.0869466515323496,0.0879221522610189,0.0884773662551440,0.0894736842105263,0.0904369854338189,0.0909266409266409,0.0917419354838710,0.0922229423201555,
    0.0927726675427070,0.0932203389830509,0.0934229137199434,0.0926416482707873,0.0929429429429429,0.0931818181818182,0.0931297709923664,0.0930214723926380,0.0920245398773006,0.0918195718654434,
    0.0915267175572519,0.0907844630616908,0.0902735562310030,0.0906463878326996,0.0899923605805959,0.0903300076745971,0.0903151421983090,0.0904141104294479,0.0904214559386973,0.0911470361816782,
    0.0913886733902250,0.0913213448006255,0.0917786561264822,0.0922337870296237,0.0931873479318735,0.0937653814602133,0.0940980881130507,0.0943650126156434,0.0947098976109215,0.0957649092480553,
    0.0958005249343832,0.0964601769911505,0.0982078853046595,0.0991840435176791,0.100274725274725,0.100645756457565,0.102604651162791,0.103267973856209,0.103292568203199,0.104990583804143,
    0.105466540999057,0.107532956685499,0.108757062146893,0.108325537885875,0.108558139534884,0.108864265927978,0.108699633699634,0.106877828054299,0.106451612903226,0.106288751107174,
    0.106555944055944,0.106551724137931,0.104177323103154,0.103952901597982,0.102242524916944,0.102134646962233,0.100729927007299,0.100241157556270,0.0990430622009570,0.0985736925515055,
    0.0996845425867508,0.0996860282574568,0.0977290524667189,0.0973437500000000,0.0977343750000000,0.0987509758001561,0.0988281250000000,0.0996087636932707,0.100078554595444,0.105213270142180,
    0.105779889152811,0.106746031746032,0.110668789808917,0.114446227929374,0.113848631239936,0.118122977346278,0.122312703583062,0.124095394736842,0.129534109816972,0.132548359966358,
    0.135004248088360,0.136926994906621,0.141899915182358,0.147028862478778,0.150212404418012,0.155894826123834,0.162130177514793,0.167030201342282,0.168421052631579,0.167889908256881,
    0.171048252911814,0.172914946325351,0.174774034511093,0.174119574119574,0.178594771241830,0.176465798045603,0.170894308943089,0.172025723472669,0.173964968152866,0.166169544740973,
    0.165085536547434};

const Float eSFRSPD_p7[nESFRSamples] =
    {0.0785182559376108,0.0782875605815832,0.0794480328831474,0.0848663101604278,0.0861865552414895,0.0863470319634703,0.0905101714772606,0.0900150375939850,0.0920247148288974,0.0942342342342342,
    0.0972484952708513,0.0995864350703060,0.102616970658208,0.103819709702063,0.106661732050333,0.109609826589595,0.109852216748768,0.112049861495845,0.112850307587150,0.114247130317353,
    0.114456233421751,0.114723127035831,0.114913957934990,0.115746549560853,0.116811414392060,0.117469135802469,0.117088217149907,0.118638871857756,0.119254278728606,0.119476567255021,
    0.120036319612591,0.120529801324503,0.120455908818236,0.120803357314149,0.121458457860132,0.121087216248507,0.121731343283582,0.121194029850746,0.122122838401908,0.121964285714286,
    0.121785714285714,0.122301304863582,0.123004139562389,0.123299822590183,0.123240685984624,0.123798219584570,0.124340527577938,0.125814234016888,0.126108075288403,0.126939523518632,
    0.128211432083589,0.129357231149567,0.131529850746269,0.131335830212235,0.133750782717596,0.135821831869511,0.137963544940289,0.139042821158690,0.141298865069357,0.143145925457991,
    0.142776025236593,0.143127364438840,0.143037177063642,0.142290748898678,0.140542244640605,0.138656527249683,0.136832061068702,0.134203821656051,0.131652839821315,0.129724535554132,
    0.127272727272727,0.126236979166667,0.124917817225510,0.124817518248175,0.124916275954454,0.124966261808367,0.125835037491479,0.126657552973342,0.126925698704840,0.127371273712737,
    0.126997985224983,0.126613439787092,0.125938117182357,0.123781676413255,0.121987179487179,0.120063091482650,0.118187461204221,0.116615760537569,0.114654654654655,0.113905325443787,
    0.113325540619521,0.113797101449275,0.114434180138568,0.115967365967366,0.117632994620442,0.118917237087741,0.120645161290323,0.122557377049180,0.123784494086728,0.125181278839815,
    0.125953177257525,0.126726519337017,0.127797833935018,0.127218045112782,0.128165771297007,0.127730441518203,0.128103044496487,0.127821316614420,0.126802507836991,0.125508607198748,
    0.124551831644583,0.124591439688716,0.124068322981366,0.122819314641745,0.122926447574335,0.123191823899371,0.122931442080378,0.123719464144996,0.122695035460993,0.123058637083994,
    0.123463687150838,0.123207091055600,0.123553382233089,0.125165016501650,0.124016736401674,0.124830508474576,0.124034334763948,0.125108601216334,0.125066195939982,0.126947179946285,
    0.126721014492754,0.128348623853211,0.129379054680259,0.130711610486891,0.130311614730878,0.132730732635585,0.135119617224880,0.136284889316651,0.139033816425121,0.139130434782609,
    0.140501446480231,0.141097208854668,0.142857142857143,0.144232602478551,0.143814919735600,0.145173383317713,0.146425255338904,0.146556473829201,0.145923913043478,0.144941808415398,
    0.144218887908208,0.144512195121951,0.144607420189819,0.144539249146758,0.145400843881857,0.145045795170691,0.142526837324525,0.141311475409836,0.140927583401139,0.139805825242718,
    0.138387096774194,0.136341659951652,0.135829307568438,0.134028892455859,0.137359098228663,0.135294117647059,0.134655870445344,0.135036496350365,0.137500000000000,0.139332247557003,
    0.141721311475410,0.141365131578947,0.146331409727947,0.150623441396509,0.151250000000000,0.154652137468567,0.157647058823529,0.163211554800340,0.166809974204643,0.172671888598782,
    0.174716652136007,0.178864628820961,0.188055797733217,0.192770034843206,0.195371179039301,0.204249783174328,0.208996539792388,0.208497854077253,0.215829787234043,0.221750212404418,
    0.223708721422523,0.227487352445194,0.228679562657696,0.231601005867561,0.236127409891031,0.234439834024896,0.235123966942149,0.230056864337937,0.230539887187752,0.228399034593725,
    0.231414868105516};

const Float eSFRSPD_p8[nESFRSamples] = {0.0964144592419143,0.0960561858454889,0.105255273998252,0.108813052970240,0.106774433691375,0.109731876861966,0.111391223155929,0.115589016829052,0.118066157760814,0.118997574777688,
    0.120558572536850,0.124212893553223,0.127962427745665,0.130769230769231,0.133922501699524,0.137990685296075,0.140962288686606,0.142508038585209,0.145210727969349,0.145161290322581,
    0.145947630922693,0.146993865030675,0.147507507507508,0.148255470136014,0.148713450292398,0.149358974358974,0.150905902980713,0.151718112987769,0.151948807446190,0.153488372093023,
    0.153654292343387,0.154108796296296,0.154303870595032,0.154519119351101,0.154255935147655,0.154782608695652,0.154614045269878,0.154481955762515,0.154752186588921,0.155043731778426,
    0.155309218203034,0.155406976744186,0.155136390017412,0.155162412993039,0.155923344947735,0.156009334889148,0.156580493537015,0.157075192421551,0.158189398451459,0.158587672052663,
    0.158929645219483,0.160664652567976,0.162226277372263,0.163941427699817,0.166422018348624,0.168524188609920,0.170674846625767,0.172928176795580,0.175798525798526,0.177415384615385,
    0.178931203931204,0.179644389944819,0.178947368421053,0.177642028100183,0.176330275229358,0.173648648648649,0.170848708487085,0.167281672816728,0.164470443349754,0.161960542540074,
    0.159603469640644,0.157133917396746,0.155843335439040,0.155130656469089,0.154633204633205,0.155678131083712,0.155701179554391,0.157593688362919,0.158781127129751,0.159011060507482,
    0.158709677419355,0.157699680511182,0.155660974067046,0.153183520599251,0.150276923076923,0.147486371895821,0.144729005360334,0.142213114754098,0.140241796200345,0.139137833238798,
    0.138711484593838,0.139422543031649,0.140165745856354,0.141964285714286,0.143940264215968,0.145678271308523,0.147538940809969,0.149715729627290,0.152781289506953,0.153578214059531,
    0.154054054054054,0.155000000000000,0.155913226032190,0.156140350877193,0.157217261904762,0.157271364317841,0.157099697885196,0.156287878787879,0.156754716981132,0.154647676161919,
    0.155257270693512,0.154944237918216,0.153600593912398,0.152228826151560,0.152769461077844,0.153007518796992,0.152754716981132,0.151320754716981,0.152312357846854,0.153323147440795,
    0.153472222222222,0.154176424668228,0.154156769596200,0.155305466237942,0.154619787408013,0.155813953488372,0.156165540540541,0.157253218884120,0.157816593886463,0.158473824312334,
    0.159082733812950,0.160802187784868,0.161751152073733,0.164892623716153,0.166729323308271,0.168838526912181,0.169194312796209,0.172053231939164,0.175285171102662,0.176944971537002,
    0.178051087984863,0.179268292682927,0.181436567164179,0.181088560885609,0.182025547445255,0.179027902790279,0.179662522202487,0.178302712160980,0.179913793103448,0.179184367034834,
    0.177051926298157,0.175867768595041,0.175836734693878,0.175645161290323,0.173944223107570,0.172913385826772,0.172677595628415,0.171916214119472,0.167925983037780,0.168384615384615,
    0.167739463601533,0.165237366003063,0.165157329240215,0.165026902382782,0.163846153846154,0.164837712519320,0.163276397515528,0.166511266511267,0.169789227166276,0.172641509433962,
    0.174526813880126,0.178305621536025,0.182975338106603,0.189280000000000,0.191157556270096,0.196284329563813,0.200893582453290,0.206193228736581,0.209916666666667,0.215585509688290,
    0.220356234096692,0.226525423728814,0.231360946745562,0.234398654331371,0.239396479463537,0.246616541353383,0.252736318407960,0.256589785831960,0.263029315960912,0.270358306188925,
    0.264482200647249,0.267654123298639,0.267731629392971,0.276372315035800,0.277567140600316,0.271840873634945,0.274102964118565,0.278736517719569,0.273720397249809,0.271299093655589,
    0.270548961424332};

const Float eSFRSPD_p9[nESFRSamples] = {0.113573770491803,0.113885963592598,0.119451751349855,0.123292867981791,0.121817332398972,0.128397477712546,0.132215447154472,0.134615384615385,0.136355311355311,0.139096437880104,
    0.145840266222962,0.149638554216867,0.153893600616808,0.158333333333333,0.163537906137184,0.166901905434016,0.171507226428080,0.173762711864407,0.177031564808596,0.179296615792966,
    0.180221932114883,0.181013470173188,0.182474874371859,0.184220297029703,0.184332925336597,0.186419001218027,0.186089078706528,0.187302551640340,0.189212121212121,0.189915458937198,
    0.190728476821192,0.191252246854404,0.192951015531661,0.192353643966547,0.192482100238663,0.193134328358209,0.193671641791045,0.193608124253286,0.193130227001195,0.193731343283582,
    0.193791044776119,0.194159713945173,0.194110648423557,0.194289113622844,0.195175699821322,0.195032914422502,0.194454490657022,0.195504252733900,0.195777233782130,0.196490147783251,
    0.197091584158416,0.198195395146235,0.199498746867168,0.201510383889239,0.203211586901763,0.206376262626263,0.208849557522124,0.211645569620253,0.214502849905003,0.215916296766011,
    0.218026565464896,0.218445988629185,0.218095838587642,0.216299559471366,0.214574132492114,0.212040557667934,0.208888888888889,0.205721551176097,0.202358189929892,0.198402555910543,
    0.195305466237942,0.193433029908973,0.191535433070866,0.190987408880053,0.190903010033445,0.191295546558704,0.192302452316076,0.193775649794802,0.194955691888207,0.195192958700068,
    0.195030221625252,0.194407456724368,0.191963109354414,0.189011703511053,0.185576923076923,0.182070707070707,0.178571428571429,0.175838926174497,0.173649459783914,0.171588895451861,
    0.171278458844133,0.171659919028340,0.172999424294761,0.174491574665892,0.176776119402985,0.179016189290162,0.181601032924467,0.183737704918033,0.186605384110309,0.188801054018445,
    0.189572192513369,0.190601243953006,0.191889934829833,0.192081447963801,0.193528505392912,0.194483294483295,0.194283476898982,0.192845911949686,0.192845911949686,0.192873923257635,
    0.191887675507020,0.190513219284603,0.189821289821290,0.190428015564202,0.189663273296789,0.189150943396226,0.188337273443656,0.189116719242902,0.188625592417062,0.188800635424940,
    0.189423076923077,0.189733225545675,0.190596892886345,0.190373443983403,0.190809443507589,0.191367521367521,0.192387543252595,0.191761612620508,0.192698130008905,0.195754290876242,
    0.195059469350412,0.196574074074074,0.197476635514019,0.199242424242424,0.199904489016237,0.202788461538462,0.206189555125725,0.207281553398058,0.210526315789474,0.213339824732230,
    0.215160349854227,0.216618357487923,0.218864292589028,0.219197707736390,0.218732261116367,0.220712277413308,0.220925925925926,0.221794871794872,0.221570397111913,0.220409982174688,
    0.220774647887324,0.220052083333333,0.219484978540773,0.218251273344652,0.218189438390612,0.216611295681063,0.215074135090610,0.213807189542484,0.212185215272136,0.211731391585761,
    0.208171521035599,0.205385852090032,0.206441223832528,0.206446414182111,0.205250403877221,0.205654281098546,0.205442729488221,0.207491856677524,0.209762100082034,0.209165302782324,
    0.213804437140509,0.218166804293972,0.221197007481297,0.227560366361366,0.230711297071130,0.235966386554622,0.238038884192730,0.246837606837607,0.255094991364421,0.259685863874346,
    0.265114235500879,0.275922671353251,0.281572052401747,0.289033942558747,0.296956521739130,0.300775862068966,0.308848797250859,0.317164816396243,0.324070945945946,0.327895181741336,
    0.338630600169062,0.338127090301003,0.337936772046589,0.346970954356847,0.340645695364238,0.335356849876948,0.338699186991870,0.336238902340597,0.331629392971246,0.336095617529881,
    0.333254531126872};

const Float eSFRSPD_p10[nESFRSamples] = {0.135662996649114,0.139858698851928,0.140937793900309,0.147678285503141,0.151387625113740,0.153829832378527,0.159861248761150,0.163977485928705,0.166458519179304,0.168108566581849,
    0.173376623376623,0.181171875000000,0.187462462462462,0.191389290882779,0.196907940969782,0.203219178082192,0.208216432865731,0.211776315789474,0.214640522875817,0.217301484828922,
    0.218158730158730,0.219600499375780,0.220917431192661,0.221600481347774,0.222665080309340,0.223905325443787,0.224792899408284,0.227106658809664,0.228319623971798,0.228671737858397,
    0.229620991253644,0.231340684852002,0.231289762868710,0.230613425925926,0.230404624277457,0.231597222222222,0.231965317919075,0.231560693641619,0.231502890173410,0.231734104046243,
    0.231986143187067,0.232469775474957,0.232107983917289,0.232548794489093,0.233008036739380,0.233948126801153,0.234069767441860,0.234426229508197,0.234961742201295,0.235701598579041,
    0.237462775461584,0.238300418910832,0.240144665461121,0.241596130592503,0.244303030303030,0.247480267152398,0.250000000000000,0.252740560292326,0.255128205128205,0.257640586797066,
    0.259096459096459,0.259426479560708,0.258379037172456,0.257151552038953,0.254728492983527,0.251503990178023,0.246711739397664,0.242769230769231,0.238655980271270,0.234570191713049,
    0.230348258706468,0.228077889447236,0.226425855513308,0.225527831094050,0.224983860555197,0.226236979166667,0.226986211424819,0.228825857519789,0.230157687253614,0.230287206266319,
    0.230271668822768,0.228635490070468,0.226362484157161,0.223076923076923,0.219358816276202,0.215361262902247,0.211343283582090,0.208044627128597,0.205372616984402,0.203872437357631,
    0.203207653348340,0.203850446428571,0.205336297943302,0.207351290684624,0.209924985574149,0.212815884476534,0.216147132169576,0.218279569892473,0.220785804816223,0.223918575063613,
    0.225645994832041,0.226484322881921,0.226536312849162,0.227967953386744,0.229420505200594,0.229094988780853,0.229088168801809,0.228063540090772,0.227815570672714,0.226842105263158,
    0.225393258426966,0.224738415545590,0.223283582089552,0.223226288274832,0.222880720180045,0.222004521477016,0.221903323262840,0.222113207547170,0.222297808012094,0.222737642585551,
    0.223867996930161,0.224244771494965,0.225078369905956,0.225477707006369,0.226413570274637,0.228442622950820,0.228571428571429,0.227885425442292,0.228571428571429,0.231537793223284,
    0.232511013215859,0.233541480820696,0.236075949367089,0.238356164383562,0.239466421343146,0.242075996292864,0.245429104477612,0.248405253283302,0.250751879699248,0.252206572769953,
    0.255440900562852,0.257409133271202,0.258202038924931,0.259300184162063,0.260456621004566,0.260523938572719,0.260427807486631,0.260598065083553,0.260000000000000,0.260754070265638,
    0.259087066779375,0.256286427976686,0.256553998351195,0.255492270138324,0.254297188755020,0.253650793650794,0.252950432730134,0.249687987519501,0.248606811145511,0.247688751926040,
    0.247348193697156,0.245007680491551,0.244589409056025,0.241622035195103,0.240490797546012,0.241865844255975,0.243199381761978,0.244006187161640,0.244875776397516,0.249063962558502,
    0.253369905956113,0.255275590551181,0.258011049723757,0.265210484511517,0.269721115537849,0.277090032154341,0.279919354838710,0.289133986928105,0.296694214876033,0.300749375520400,
    0.302104377104377,0.315054667788057,0.321368948247078,0.331882845188285,0.334448160535117,0.348750000000000,0.358789386401327,0.355192150449714,0.358813972380179,0.368510984540277,
    0.381581092094540,0.375502008032129,0.376080000000000,0.385635359116022,0.389074960127592,0.387124802527646,0.386285266457680,0.393457943925234,0.390852713178295,0.393226788432268,
    0.383863636363636};

const Float eSFRSPD_p11[nESFRSamples] = {0.147977315689981,0.154851451142023,0.157985028072364,0.161326746647848,0.170416343418671,0.176569037656904,0.181302170283806,0.185730700929698,0.189713155291790,0.197945845004669,
    0.204185218165628,0.209812286689420,0.217455138662316,0.226530612244898,0.234927866362946,0.240546528803545,0.247951114306254,0.253211009174312,0.256884561891516,0.259081562714188,
    0.261750841750842,0.263143989431968,0.263606981254040,0.265521628498728,0.266813324952860,0.267582760774516,0.269369931378665,0.270755885997522,0.272115977791487,0.273006134969325,
    0.274405850091408,0.274878934624697,0.275240963855422,0.275706554419723,0.275733972438586,0.275822860562537,0.275343283582090,0.275283582089552,0.274731823599523,0.274910820451843,
    0.275326991676576,0.275651658767773,0.276063829787234,0.276137034849380,0.276404494382022,0.276083086053412,0.276766467065868,0.276584188292094,0.277095990279465,0.277750611246944,
    0.278782287822878,0.279715522572665,0.281308411214953,0.283750000000000,0.286278195488722,0.289014438166981,0.292201257861635,0.295280050346130,0.298108448928121,0.300631711939356,
    0.302145110410095,0.303091482649842,0.302143757881463,0.301008827238335,0.298104864181933,0.295486331849968,0.290943877551020,0.286389776357828,0.282232200128287,0.277334191886671,
    0.273346303501946,0.270904325032765,0.268295904887715,0.267511674449633,0.268013468013468,0.268860244233379,0.270342465753425,0.271408934707904,0.273269362577108,0.274046321525886,
    0.273144399460189,0.271858288770054,0.269266358228685,0.265319426336376,0.261182519280206,0.256645569620253,0.252490660024907,0.247887323943662,0.245054282267793,0.242721330956625,
    0.241984732824427,0.242224810716366,0.243155452436195,0.245960187353630,0.248257211538462,0.251594746716698,0.254498381877023,0.257537853851218,0.260330033003300,0.262135278514589,
    0.264448924731183,0.265811373092927,0.266594202898551,0.266037735849057,0.267642526964561,0.268040435458787,0.268000000000000,0.266640378548896,0.266298342541437,0.265563435776202,
    0.264437450826121,0.263108320251177,0.262225705329154,0.261538461538462,0.260457774269929,0.260697305863708,0.260476190476191,0.259857482185273,0.261203483768804,0.261526232114467,
    0.262449959967974,0.262580645161290,0.262754686226569,0.263583815028902,0.264661654135338,0.265707027942422,0.266181506849315,0.266580086580087,0.267838312829525,0.269244444444444,
    0.271557155715572,0.273837739288970,0.275506445672192,0.279981378026071,0.282502351834431,0.285754985754986,0.288899521531101,0.291153846153846,0.292760617760618,0.295934172313650,
    0.301162790697674,0.303764478764479,0.307046332046332,0.307396733909702,0.306666666666667,0.305576559546314,0.306922357343311,0.307222222222222,0.307783882783883,0.305605786618445,
    0.303392857142857,0.301851851851852,0.299825479930192,0.297932816537468,0.296598639455782,0.296212121212121,0.294338051623647,0.292326732673267,0.289352989352989,0.288417618270799,
    0.287967479674797,0.284846029173420,0.282510121457490,0.281598062953995,0.280840743734842,0.280809716599190,0.283847402597403,0.285296506904955,0.287041564792176,0.291728091728092,
    0.293765381460213,0.296872427983539,0.302396694214876,0.308395677472984,0.316066945606695,0.322857142857143,0.332739609838847,0.338487972508591,0.346140503035559,0.353705318221447,
    0.362214411247803,0.367753303964758,0.379173989455185,0.387401574803150,0.390455341506130,0.394778067885118,0.408369283865401,0.421850899742931,0.428778821520068,0.432372881355932,
    0.443702451394759,0.447355163727960,0.447666666666667,0.437685950413223,0.443221035332786,0.449259868421053,0.446428571428571,0.438362760834671,0.439206349206349,0.438388625592417,
    0.436571879936809};

const Float eSFRSPD_p12[nESFRSamples] = {0.182214866084863,0.185442422558689,0.188289322617681,0.197697638905204,0.201196302338227,0.208003250050782,0.212072243346008,0.216021602160216,0.221170395869191,0.226579163248564,
    0.232807570977918,0.240517897943641,0.250513196480938,0.261543909348442,0.272333103922918,0.281506388702085,0.290078843626807,0.295719844357977,0.300966494845361,0.304664536741214,
    0.306049149338374,0.308550185873606,0.310733778047301,0.312238805970149,0.312809917355372,0.315185403178340,0.316558632881556,0.318459729570841,0.321080446271286,0.322697947214076,
    0.323639555295494,0.324343257443082,0.324403028538148,0.323848396501458,0.323440233236152,0.323175715119673,0.323306074766355,0.323302107728337,0.322860492379836,0.322684642438453,
    0.323270808909730,0.322852133255406,0.322390670553936,0.322915451895044,0.322897196261682,0.322274325908558,0.322662721893491,0.322857142857143,0.323053892215569,0.323178807947020,
    0.323789346246973,0.324665856622114,0.326148193508879,0.328316953316953,0.331219211822660,0.333456561922366,0.336790123456790,0.340457072266831,0.343475572047001,0.346993180409175,
    0.347990105132962,0.348580246913580,0.348243992606285,0.346707692307692,0.343834771886560,0.339108910891089,0.334841909485431,0.329491945477076,0.324503722084367,0.319192546583851,
    0.315552779512805,0.311861198738170,0.309548058561426,0.308413615928067,0.308630759247242,0.309293193717278,0.311302048909451,0.312458581842280,0.314077990746861,0.314642153644123,
    0.313728041639558,0.312637008381689,0.308992346938776,0.305289672544081,0.300186104218362,0.294810744810745,0.289849849849850,0.285899705014749,0.281137550783517,0.279188107489994,
    0.278712591756070,0.279171332586786,0.280267558528428,0.283098591549296,0.285855072463768,0.289104116222760,0.292592592592593,0.296624203821656,0.300510204081633,0.301980830670927,
    0.303698896820247,0.304704301075269,0.305928016937191,0.306995581737850,0.307801950487622,0.307552870090634,0.307305936073059,0.306564885496183,0.307001522070015,0.305450416351249,
    0.303765060240964,0.302627627627628,0.301869857890800,0.301499250374813,0.299245852187029,0.299318181818182,0.299011406844107,0.298707224334601,0.299694889397407,0.299309815950920,
    0.300464756003098,0.300860719874804,0.300713719270420,0.301612903225806,0.302129402129402,0.302826267664173,0.304057480980558,0.305488850771870,0.304363001745201,0.306477373558119,
    0.309450945094509,0.310928961748634,0.314022140221402,0.317553688141924,0.320715630885122,0.322232734153264,0.325760456273764,0.329198473282443,0.333428844317096,0.336034318398475,
    0.338366571699905,0.340226628895184,0.341518275538894,0.344702602230483,0.347194112235511,0.347636363636364,0.348294434470377,0.348720211827008,0.346267361111111,0.347043701799486,
    0.346446700507614,0.345993322203673,0.344600164880462,0.344698205546493,0.343639291465378,0.342356687898089,0.340708661417323,0.339184952978056,0.336505460218409,0.332660977501940,
    0.331298299845441,0.329311678267595,0.326914153132251,0.324593967517401,0.324515128006206,0.324532710280374,0.323965651834504,0.326802507836991,0.328874901652242,0.334493670886076,
    0.337460317460317,0.340749601275917,0.343929712460064,0.351974214343272,0.353510895883777,0.360470779220779,0.369902120717781,0.377851239669422,0.385271966527197,0.391878172588832,
    0.400764006791171,0.408510638297872,0.418612521150592,0.424534686971235,0.436677908937605,0.445973154362416,0.452500000000000,0.462831125827815,0.467269736842105,0.475102040816327,
    0.475912408759124,0.486596263200650,0.494232331437855,0.496370967741936,0.495222929936306,0.494686756542427,0.496658711217184,0.490070367474590,0.489612403100775,0.496434108527132,
    0.497313891020722};

const Float eSFRSPD_p13[nESFRSamples] = {0.196700735162274,0.204489595281009,0.210825358851675,0.218826405867971,0.219992521500686,0.228901734104046,0.236304700162075,0.241670052824055,0.244219653179191,0.249271402550091,
    0.259895379250218,0.270460251046025,0.281716118684844,0.294444444444444,0.309491778774290,0.321106259097526,0.330970942593905,0.337813370473538,0.345905024088094,0.350577838205303,
    0.353805073431242,0.355774278215223,0.357803468208093,0.359027777777778,0.360948222083593,0.362693978895096,0.365031055900621,0.367325509573811,0.369046153846154,0.371323529411765,
    0.372760511882998,0.373228346456693,0.373309178743961,0.372979493365501,0.373088500903071,0.372175480769231,0.371788715486194,0.371951951951952,0.372285542891422,0.371282973621103,
    0.370778443113772,0.371283582089552,0.371828469326980,0.371828469326980,0.371198568872987,0.370137642130461,0.371497584541063,0.369586374695864,0.369254278728606,0.369987699876999,
    0.370606435643564,0.371126322339764,0.373166144200627,0.375031446540881,0.377112232030265,0.380795957043588,0.384430379746835,0.388656527249683,0.392332065906210,0.395362134688691,
    0.397590361445783,0.397784810126582,0.397658227848101,0.395632911392405,0.392332065906210,0.387555839183153,0.382725527831094,0.377179487179487,0.372218649517685,0.366215344938749,
    0.361428571428571,0.357086614173228,0.354503311258278,0.353676470588235,0.353274814314652,0.353877551020408,0.356219931271478,0.357339765678842,0.358734525447043,0.359945317840055,
    0.359214092140921,0.357181208053691,0.352055702917772,0.348199083169614,0.342737249838606,0.336999364272092,0.330956848030019,0.326183159188691,0.321778584392015,0.319189511323004,
    0.318149675898645,0.318808411214953,0.320908561444380,0.323927101704879,0.326899879372738,0.329943502824859,0.333897202342225,0.337739590218110,0.342279655400928,0.343912175648703,
    0.346693657219973,0.348571428571429,0.350254916241806,0.350379362670713,0.351860465116279,0.353088350273651,0.352009456264775,0.350158227848101,0.350118764845606,0.348104265402844,
    0.347675334909377,0.346656176239182,0.344697564807541,0.344846577498033,0.344180522565321,0.343253968253968,0.342925278219396,0.343208895949166,0.343606036536934,0.344249201277955,
    0.345454545454545,0.346022727272727,0.346431501230517,0.347342192691030,0.348020219039596,0.349104859335038,0.350518134715026,0.350481189851269,0.351996450754215,0.353237410071943,
    0.357247037374658,0.358856088560886,0.361380597014925,0.365000000000000,0.368571428571429,0.372552783109405,0.375169082125604,0.377788554801164,0.382829268292683,0.384487804878049,
    0.387828627069133,0.392135922330097,0.393986420950534,0.394691119691120,0.394827586206897,0.396398104265403,0.396619718309859,0.395353159851301,0.394128440366972,0.393574660633484,
    0.390966010733453,0.390282685512368,0.389694323144105,0.390077653149267,0.386541737649063,0.383865546218487,0.381916666666667,0.379321753515302,0.376398026315789,0.376816326530612,
    0.372786352558895,0.371080422420796,0.370487804878049,0.368288726682887,0.368937550689376,0.370358306188925,0.368541157294214,0.372534637326813,0.372972972972973,0.380493827160494,
    0.383663366336634,0.388916459884202,0.393946932006634,0.401170568561873,0.408228379513014,0.417159763313610,0.424744897959184,0.431298366294067,0.441110147441457,0.447373029772329,
    0.455212014134276,0.464627659574468,0.475330396475771,0.484242957746479,0.491659350307287,0.498076923076923,0.514572425828970,0.518528138528139,0.526810344827586,0.539931153184165,
    0.546666666666667,0.548126064735946,0.555508474576271,0.552582557154954,0.558067226890756,0.556975772765247,0.560000000000000,0.560794044665012,0.556290849673203,0.556107491856678,
    0.551174089068826};

const Float eSFRSPD_p14[nESFRSamples] = {0.228513307340227,0.232189973614776,0.238486609040669,0.249126891734575,0.252948885976409,0.261023709284290,0.268275005177055,0.275438596491228,0.281313598519889,0.290008764241893,
    0.299832355406538,0.314032258064516,0.326682134570766,0.342485119047619,0.358759913482336,0.373928320449754,0.387731322823852,0.397370195549562,0.406341789052069,0.411492734478203,
    0.415194805194805,0.417665816326531,0.419713038053649,0.420933087783917,0.423226197695573,0.424366706875754,0.425934861278649,0.429351740696279,0.431100478468900,0.432817153067302,
    0.433254297569650,0.434887839433294,0.435117647058824,0.434527304756312,0.433274751025190,0.432649472450176,0.431187829139848,0.431323185011710,0.430620608899297,0.430971896955504,
    0.429842012873025,0.429813302217036,0.429511059371362,0.430133798720186,0.430500582072177,0.429339567504383,0.430442477876106,0.429691211401425,0.428673835125448,0.429326923076923,
    0.430290205562273,0.430619684082625,0.431784841075795,0.435995085995086,0.438854679802956,0.441491985203453,0.446662546353523,0.450804455445545,0.455142503097893,0.458732131758856,
    0.460893854748603,0.461500309981401,0.460904584882280,0.458921933085502,0.454720496894410,0.449157829070493,0.443053817271589,0.436608260325407,0.429968652037618,0.423255813953488,
    0.417330803289058,0.413026819923372,0.409922680412371,0.408387516254876,0.408459016393443,0.410185185185185,0.410873915943963,0.413453815261044,0.414342895263509,0.415705765407555,
    0.414848883048620,0.412028608582575,0.408108108108108,0.402349206349206,0.396247654784240,0.390080098582871,0.383575757575758,0.377817531305903,0.374206815511163,0.371627099015634,
    0.370120206067544,0.370698466780239,0.373386183465459,0.376514285714286,0.380270111567822,0.384332925336597,0.389403553299492,0.394587628865979,0.398386055519690,0.401555411535969,
    0.404733727810651,0.407472826086957,0.408948863636364,0.409548482605477,0.410649546827795,0.411652703731912,0.411273006134969,0.409930715935335,0.409384615384615,0.407969348659004,
    0.406722689075630,0.405788271134806,0.405171102661597,0.403422053231939,0.402599388379205,0.402455871066769,0.402767102229055,0.403609831029186,0.404611837048424,0.404163454124904,
    0.404432348367030,0.406122448979592,0.406825396825397,0.408045052292840,0.407504078303426,0.409677419354839,0.410226320201173,0.410950764006791,0.413828867761452,0.414185639229422,
    0.415514184397163,0.416965888689408,0.421344232515895,0.424011039558418,0.427710843373494,0.431121495327103,0.433740601503759,0.437712665406427,0.442450142450142,0.444212523719165,
    0.446394686907021,0.448865784499055,0.453440150801131,0.454732895970009,0.454916512059369,0.457050691244240,0.457285974499089,0.456294964028777,0.454973357015986,0.453987730061350,
    0.454805194805195,0.453885567890692,0.451732882502113,0.451876563803169,0.451812191103789,0.449267100977199,0.446537842190016,0.443974461292897,0.441521394611727,0.439243498817967,
    0.436577708006279,0.436278342455043,0.433645589383294,0.431669266770671,0.431537861046058,0.428984375000000,0.429913860610807,0.431529411764706,0.436198738170347,0.441120757695343,
    0.446147736298650,0.452551834130782,0.456629392971246,0.462439807383628,0.471844660194175,0.477353896103896,0.485118560915781,0.491074380165289,0.504103852596315,0.511467116357504,
    0.516454622561493,0.524152542372881,0.534520780322307,0.546055979643766,0.553807106598985,0.560810810810811,0.572063758389262,0.581317764804003,0.585525227460711,0.586892003297609,
    0.593015612161052,0.600736497545008,0.600407497962510,0.598866396761134,0.610210696920583,0.608842443729904,0.612789768185452,0.601434262948207,0.605974842767296,0.604442712392829,
    0.602558139534884};

const Float eSFRSPD_p15[nESFRSamples] = {0.250136338847482,0.260724975058198,0.269037847697218,0.280866326389847,0.282406242134407,0.291286015460295,0.300917832167832,0.309188188085194,0.318146341463415,0.328162511542013,
    0.339629302736099,0.356694915254237,0.372366288492707,0.391725214676034,0.410649546827795,0.428350515463918,0.445272206303725,0.458521126760563,0.470215727209464,0.476769759450172,
    0.479568442346595,0.481842279655401,0.484760051880674,0.486726228462029,0.488713745271122,0.491588198367859,0.493609022556391,0.496756082345602,0.500248601615911,0.502039555006181,
    0.502518427518428,0.502684563758389,0.503159173754557,0.502183141297756,0.500845410628019,0.499818949909475,0.498794454490657,0.497951807228916,0.497890295358650,0.496327513546057,
    0.495903614457831,0.495195195195195,0.495623501199041,0.495980803839232,0.494717887154862,0.494695599758891,0.494583079732197,0.493570116350276,0.493896424167694,0.494292803970223,
    0.494759825327511,0.495796737766625,0.497853535353535,0.500951173113507,0.505657978385251,0.509357097390197,0.514668367346939,0.520817369093231,0.526564495530013,0.530838131797825,
    0.534590792838875,0.535823754789272,0.535459183673470,0.534375000000000,0.529456869009585,0.524084778420039,0.517783505154639,0.510516129032258,0.503298835705045,0.497270955165692,
    0.490522875816994,0.485865257595773,0.482733333333333,0.480551816958277,0.481182065217391,0.482067077344285,0.484530386740332,0.486685159500694,0.488865836791148,0.489010989010989,
    0.488351498637602,0.486302294197031,0.480666666666667,0.475378538512179,0.468547341115435,0.461533546325879,0.454368321810182,0.448331273176761,0.443639683505782,0.439928057553957,
    0.439537640782454,0.440235294117647,0.442296426479203,0.445594322885866,0.450060679611650,0.454958938723942,0.459908436886854,0.465425531914894,0.469600000000000,0.474413931681179,
    0.477038043478261,0.479102384291725,0.481451612903226,0.482582123758594,0.484555382215289,0.484264358772620,0.483822363203807,0.482709163346614,0.481434262948207,0.480842607313196,
    0.478492063492063,0.477179080824089,0.475632911392405,0.474584323040380,0.473487261146497,0.473520000000000,0.473157051282051,0.473979183346677,0.474859887910328,0.475462590506838,
    0.476580226904376,0.477061224489796,0.478199834847234,0.477257525083612,0.479678238780694,0.479845626072041,0.480902777777778,0.482321899736148,0.483839285714286,0.485443037974684,
    0.486733760292772,0.490092592592593,0.493539325842697,0.496869070208729,0.501434034416826,0.503849855630414,0.505905130687319,0.510126582278481,0.515557729941292,0.519686581782566,
    0.522211350293542,0.526146341463415,0.529571984435798,0.532913843175218,0.532149712092131,0.532635585156993,0.535283018867925,0.535387488328665,0.533425414364641,0.532240437158470,
    0.530963096309631,0.529600000000000,0.527704485488127,0.525803649000869,0.524484536082474,0.524363327674024,0.520657672849916,0.517710944026734,0.514854771784232,0.511725846407927,
    0.509218106995885,0.505172413793104,0.504519309778143,0.501554828150573,0.499590163934426,0.500575657894737,0.502967848309975,0.505037159372419,0.508450704225352,0.509038142620232,
    0.514929107589658,0.520735785953177,0.528415758591786,0.532771693344566,0.539458086367485,0.547566182749787,0.558390410958904,0.567443868739206,0.575543951261967,0.585286343612335,
    0.594014084507042,0.602920353982301,0.615039577836412,0.628961267605634,0.640561896400351,0.641732283464567,0.651170858629662,0.664766839378238,0.674438687392055,0.684372331340734,
    0.683105802047782,0.684210526315790,0.688513513513514,0.683724832214765,0.690947191953060,0.695321637426901,0.691943521594684,0.687326246933770,0.686296900489396,0.689529220779221,
    0.678554216867470};

const Float eSFRSPD_p16[nESFRSamples] = {0.273508430609598,0.284304932735426,0.291056019723326,0.302174456385904,0.313012354231613,0.323146454320456,0.331653733749874,0.340285714285714,0.349365942028986,0.361982758620690,
    0.376548307184145,0.395939490445860,0.417201834862385,0.440191740412979,0.464449213161660,0.488625261688765,0.508021753908906,0.525083836351442,0.536926147704591,0.545364891518738,
    0.550000000000000,0.552705283259071,0.554953271028037,0.558246474555487,0.560084797092671,0.562484921592280,0.566002415458937,0.569031870114251,0.571925614877025,0.573998804542738,
    0.575580702799285,0.574748073503260,0.574334713187463,0.573238602723505,0.570324483775811,0.568871825162434,0.567631423508565,0.565327820437094,0.563496751329002,0.563496751329002,
    0.562138216184288,0.561484098939929,0.559988249118684,0.559248385202584,0.558470588235294,0.557851239669422,0.557236450268017,0.556242496998800,0.555488540410133,0.553636363636364,
    0.554661791590494,0.555637254901961,0.557125231338680,0.559715346534654,0.563647642679901,0.567639751552795,0.572885572139304,0.579314641744548,0.583780411728010,0.589062500000000,
    0.593129294191131,0.594264339152120,0.594264339152120,0.591588785046729,0.587398627573300,0.580301129234630,0.573350094280327,0.566142227816237,0.558990536277603,0.551612903225807,
    0.544783715012723,0.539242132305716,0.536098509397278,0.534270765206017,0.533949801849406,0.535309793471019,0.537995965030262,0.538611859838275,0.541627437794217,0.542017368069472,
    0.541005291005291,0.537786509495743,0.532448186528497,0.525703324808184,0.518261964735516,0.510966542750930,0.503963414634146,0.496582733812950,0.491445427728614,0.488139534883721,
    0.487241379310345,0.487970353477765,0.489892106757524,0.495352839931153,0.499116087212728,0.503687768899816,0.509114085404716,0.515284974093264,0.519896305897602,0.524137931034483,
    0.527675033025099,0.529829351535836,0.531142857142857,0.533233979135618,0.533409263477601,0.534712643678161,0.534876543209877,0.534624322230829,0.532972136222910,0.531100846805235,
    0.530544896392939,0.530091883614089,0.527196333078686,0.527905198776759,0.526923076923077,0.526409266409266,0.525058004640371,0.525502318392581,0.526238390092879,0.525874125874126,
    0.527372549019608,0.527892234548336,0.528685897435897,0.529048006509357,0.530305532617671,0.531882845188285,0.532710280373832,0.533103448275862,0.534706397896582,0.537132680320570,
    0.539350180505415,0.542100456621005,0.546438482886217,0.549111318989710,0.552735849056604,0.556695156695157,0.560707456978968,0.567083734359962,0.569913211186114,0.574373795761079,
    0.576804619826757,0.580382775119617,0.583858643744031,0.582703213610586,0.583505154639175,0.585807050092765,0.585491276400367,0.584886877828054,0.584271671134942,0.582394366197183,
    0.581391304347826,0.580051369863014,0.579000846740051,0.577090301003345,0.574071015689513,0.572349102773246,0.569354838709677,0.568669871794872,0.565498007968127,0.563549920760697,
    0.556816390858944,0.555826771653543,0.553579858379229,0.553574234092695,0.550157232704403,0.551737756714060,0.552332015810277,0.555352894528152,0.558253968253968,0.565095846645367,
    0.567253803042434,0.574698795180723,0.582352941176471,0.590503246753247,0.597879282218597,0.605004101722724,0.610955518945634,0.625647451963242,0.629332206255283,0.641816623821765,
    0.646952789699571,0.661777394305436,0.666294067067928,0.678149100257069,0.687606837606838,0.699230111206159,0.709454855195911,0.720135363790186,0.719414225941423,0.732303839732888,
    0.731000000000000,0.738589211618257,0.741770057899090,0.740444810543657,0.735941320293399,0.735360908353609,0.734947538337369,0.724543288324067,0.721563981042654,0.727507836990596,
    0.722620904836194};

const Float eSFRSPD_p17[nESFRSamples] = {0.300236806495264,0.311232449297972,0.317891146795509,0.333203732503888,0.343963553530752,0.355582794740361,0.362869637650979,0.372173058013766,0.384629803186504,0.398932384341637,
    0.415784982935154,0.438208709942482,0.463665086887836,0.492149390243903,0.520842572062084,0.548161499639510,0.572452565003514,0.591343490304709,0.606652949245542,0.615785907859079,
    0.621466666666667,0.625032765399738,0.628287363694676,0.630618686868687,0.632563942607611,0.634782608695652,0.638284648850218,0.642326732673267,0.645280690931524,0.647384615384615,
    0.647887323943662,0.647775746496039,0.646023072252581,0.643594414086217,0.642035130224107,0.639006662628710,0.634824667472793,0.633393829401089,0.632344033918837,0.630145278450363,
    0.627723970944310,0.626658624849216,0.626280892103677,0.625075346594334,0.623642943305187,0.623258631132647,0.622249388753056,0.621688231669747,0.621437422552664,0.620623052959502,
    0.620100187852223,0.622166246851385,0.625348542458809,0.628325907065564,0.632844387755102,0.639386189258312,0.646606914212548,0.653205128205128,0.659178433889602,0.665809768637532,
    0.671162491971741,0.674150096215523,0.674358974358974,0.672855313700384,0.668589743589744,0.662371134020619,0.653970303421562,0.647058823529412,0.639662994167207,0.632184655396619,
    0.624183006535948,0.620158625247852,0.616800000000000,0.614737550471063,0.614402173913043,0.615479452054795,0.616804979253112,0.618888888888889,0.621468144044321,0.621030927835052,
    0.620177232447171,0.615519568151147,0.611281708945260,0.603820816864295,0.595262816353018,0.587595907928389,0.580125786163522,0.572744128553770,0.567863664029215,0.564367126574685,
    0.563366923532899,0.564453584018801,0.566627634660422,0.571099290780142,0.575895567698846,0.581024667931689,0.587335958005249,0.593600000000000,0.599665998663995,0.604155495978552,
    0.606934058463630,0.609276177090654,0.611838235294118,0.613496932515337,0.615258215962441,0.615299684542587,0.615023847376789,0.615894568690096,0.613955342902711,0.614001591089897,
    0.611727416798732,0.610838607594937,0.609865824782952,0.608537549407115,0.607802547770701,0.606714628297362,0.607051282051282,0.606164931945557,0.606415396952686,0.606204673650282,
    0.607235772357724,0.606557377049180,0.607302904564316,0.608249158249158,0.609316239316239,0.609177489177489,0.609385964912281,0.609955555555556,0.611472448057814,0.613761467889908,
    0.615706319702602,0.618944392082941,0.622740247383444,0.626254826254826,0.629708737864078,0.633561643835616,0.637500000000000,0.642984189723320,0.647420634920635,0.652480158730159,
    0.656336633663366,0.660552268244576,0.662696850393701,0.662926829268293,0.666054158607350,0.665421455938697,0.664778092540132,0.665205223880597,0.666112650046168,0.663876251137398,
    0.661669658886894,0.659840425531915,0.659509202453988,0.656006914433881,0.652770673486786,0.651433389544688,0.646488294314381,0.644112769485904,0.643646864686469,0.640360951599672,
    0.634725634725635,0.632761437908497,0.631510204081633,0.630374592833876,0.625511038430090,0.631691297208539,0.630977814297453,0.634624896949711,0.635891089108911,0.639386401326700,
    0.645257903494176,0.651876563803169,0.656412405699916,0.668104906937394,0.676400679117148,0.683945345858241,0.693121238177128,0.699651871192341,0.708165057067603,0.712854609929078,
    0.721109123434705,0.733930170098478,0.743175735950045,0.753667262969589,0.766221033868093,0.763805309734513,0.779313380281690,0.776465441819773,0.781212121212121,0.789948006932409,
    0.791128337639966,0.793071000855432,0.801025641025641,0.795185810810811,0.789113924050633,0.797893850042123,0.798994974874372,0.792733278282411,0.788752052545156,0.791109298531811,
    0.783685064935065};
const Float eSFRSPD_p18[nESFRSamples] = {0.330556540233960,0.339782149244025,0.349046844983006,0.362141027369556,0.375897944017835,0.386911595866820,0.397430406852248,0.407620199576656,0.420343839541547,0.435230352303523,
    0.455133735979292,0.483374896093101,0.511633466135458,0.547090352220521,0.582518518518519,0.617039711191336,0.647013352073085,0.672739820565908,0.692622950819672,0.703778677462888,
    0.711538461538462,0.716612377850163,0.720663265306123,0.722710163111669,0.725526641883519,0.727216748768473,0.732758620689655,0.735168195718654,0.738414634146342,0.740740740740741,
    0.741389728096677,0.740096038415366,0.738792588164973,0.735961768219833,0.732738095238095,0.728732897085068,0.726084373143197,0.722255192878338,0.720142602495544,0.717507418397626,
    0.716913946587537,0.715552927261975,0.714454277286136,0.712853773584906,0.711924439197167,0.711321873147599,0.709080047789725,0.708433734939759,0.707878787878788,0.707495429616088,
    0.707107843137255,0.707768187422935,0.709057071960298,0.711526479750779,0.715980024968789,0.720625000000000,0.725735754539762,0.731034482758621,0.737602008788450,0.741976085588420,
    0.744654088050314,0.746231155778894,0.746859296482412,0.744346733668342,0.739458779106356,0.732278481012658,0.725428027901078,0.717916137229987,0.711281070745698,0.703964194373402,
    0.697106109324759,0.691758598312784,0.688277668631303,0.686715135492399,0.686457638425617,0.686827956989247,0.689748811948405,0.690735694822888,0.692464358452139,0.693657219973009,
    0.691844919786096,0.688285903375248,0.682352941176471,0.676774193548387,0.669421487603306,0.661865998747652,0.654959950708564,0.647878787878788,0.642601431980907,0.640000000000000,
    0.638743455497382,0.640300230946882,0.643268124280783,0.647502903600465,0.652147971360382,0.657551274083282,0.662588538312943,0.669502617801047,0.674540682414698,0.678736010533246,
    0.680907877169560,0.684000000000000,0.686517664023072,0.687312312312312,0.688591117917305,0.689884169884170,0.689485981308411,0.689444878811572,0.687187500000000,0.686526479750779,
    0.685003885003885,0.683733539891557,0.683062645011601,0.681874515879163,0.679688715953307,0.679749804534793,0.679655712050078,0.679593432369038,0.680078125000000,0.680690737833595,
    0.680790513833992,0.681897926634769,0.682903225806452,0.681944444444444,0.683278145695364,0.684395973154362,0.684112149532710,0.685185185185185,0.685052447552448,0.688642413487134,
    0.691292639138241,0.694000000000000,0.697056117755290,0.698696461824953,0.704319248826291,0.707095553453169,0.709705042816365,0.711281070745698,0.715850144092219,0.719634263715111,
    0.721593090211133,0.725000000000000,0.726812977099237,0.726685660018993,0.728180961357210,0.728478057889823,0.727844588344126,0.728062157221207,0.729087624209576,0.728686327077748,
    0.725704225352113,0.727526132404181,0.724935511607911,0.723174872665535,0.720050335570470,0.721742738589212,0.719770303527482,0.716870415647922,0.714100486223663,0.712962962962963,
    0.709775641025641,0.708379888268157,0.706459330143541,0.704852824184566,0.702068416865553,0.706449044585987,0.706629392971246,0.708073541167066,0.708726981585268,0.713365539452496,
    0.720695230396120,0.726234817813765,0.728003246753247,0.732055464926591,0.742152834839770,0.748554913294798,0.756146179401993,0.763498738435660,0.773361702127660,0.775363558597092,
    0.779242032730405,0.792461005199307,0.800346620450607,0.805617977528090,0.806878761822872,0.818330464716007,0.822231686541738,0.821827411167513,0.824915540540541,0.830930427493713,
    0.832523051131601,0.837792642140468,0.830985915492958,0.845446950710109,0.843983402489627,0.833881578947368,0.829129373474369,0.830906148867314,0.818545163868905,0.816521048451152,
    0.814229249011858};

const Float eSFRSPD_p19[nESFRSamples] = {0.367180577706894,0.377496346809547,0.392040392040392,0.404842418503990,0.415652173913043,0.426263558735287,0.438795336787565,0.448940269749518,0.460442733397498,0.478142076502732,
    0.500348735832607,0.531208053691275,0.561587810745790,0.599690641918020,0.640810202550638,0.679459064327485,0.712455516014235,0.741415557112824,0.762629757785467,0.776486671223513,
    0.785090664875755,0.789960369881110,0.793794440853264,0.796567069294342,0.800125707102451,0.802623360399750,0.805746408494691,0.811062771908017,0.814356435643564,0.816389402341343,
    0.817791411042945,0.816961561928005,0.814589665653495,0.811286407766990,0.807134220072551,0.804597701149425,0.801328502415459,0.798309178743962,0.796016898008449,0.793727382388420,
    0.792521109770808,0.790739627179796,0.789442111577684,0.788369304556355,0.787860576923077,0.786618444846293,0.785757760194766,0.784926470588235,0.784083898827884,0.782878411910670,
    0.782283218964442,0.783427495291902,0.783817951959545,0.785668991756500,0.788302606484425,0.792356687898089,0.795918367346939,0.801790281329923,0.803833865814697,0.809096732863549,
    0.811779769526248,0.812779552715655,0.813537675606641,0.812140575079872,0.809980806142035,0.805662805662806,0.800902061855670,0.795997417688832,0.790938511326861,0.787012987012987,
    0.782495101241019,0.778217821782178,0.775632490013316,0.774865591397850,0.774762550881954,0.775119617224880,0.776397515527950,0.777700831024931,0.777087646652864,0.777777777777778,
    0.777702243371856,0.774562584118439,0.770459081836327,0.765748031496063,0.760672703751617,0.756532823454430,0.751097178683386,0.745992601726264,0.742562234365513,0.739832535885167,
    0.739207569485512,0.739589442815249,0.741238317757009,0.743952802359882,0.747272727272727,0.751105495893872,0.753433616742969,0.757978723404255,0.762666666666667,0.765060240963855,
    0.767663043478261,0.769284712482469,0.770527859237537,0.771406727828746,0.771784879189400,0.772562893081761,0.772979397781299,0.771519490851233,0.770723945902944,0.770714285714286,
    0.770094936708861,0.768113654301500,0.768454258675079,0.767377567140600,0.767355043685465,0.766746411483254,0.765921787709497,0.765948963317384,0.765921787709497,0.765998396150762,
    0.766478190630049,0.765798045602606,0.765980230642504,0.766944908180301,0.767908552074513,0.769699570815451,0.768315972222222,0.769332161687171,0.769821428571429,0.772620126926564,
    0.772502291475710,0.775139146567718,0.776476101218369,0.779582146248813,0.780363984674330,0.786003861003861,0.787755102040816,0.791015625000000,0.792836113837095,0.796074582924436,
    0.796771037181996,0.801368523949169,0.799416342412451,0.801548886737657,0.801150527325024,0.801806083650190,0.801881467544685,0.802790697674419,0.803863845446182,0.804272727272727,
    0.800537153088630,0.802568644818423,0.798602620087336,0.797841105354059,0.798206660973527,0.797974683544304,0.795735785953177,0.792957746478873,0.790781893004115,0.788153594771242,
    0.790441176470588,0.786829268292683,0.787083671811535,0.785251215559157,0.783617193836172,0.784552845528455,0.785598047192840,0.787601957585644,0.786846405228758,0.792269736842105,
    0.793986820428336,0.795544554455446,0.801657000828500,0.804427736006684,0.808892617449665,0.812647554806071,0.814613423959218,0.818423307626392,0.824003466204506,0.828245614035088,
    0.830599647266314,0.835017730496454,0.838800705467372,0.844444444444444,0.849735449735450,0.842594215600350,0.845383275261324,0.848180242634315,0.850301464254953,0.846786632390746,
    0.848249359521776,0.847667514843087,0.847972972972973,0.845117845117845,0.848154362416107,0.848206839032527,0.844059405940594,0.841673502871206,0.838079739625712,0.829600000000000,
    0.828186856690420};
const Float eSFRSPD_p20[nESFRSamples] = {0.393413654618474,0.409419754909198,0.423601637107776,0.437033349925336,0.452238805970149,0.464519592055824,0.480484114977307,0.495328884652050,0.509519492293744,0.531892826274849,
    0.557995028997515,0.596311146752205,0.636279784780938,0.686106983655275,0.736652236652237,0.784658691062632,0.829670329670330,0.867118644067797,0.897177419354839,0.915502328675981,
    0.924738219895288,0.931788931788932,0.936317780580076,0.939788950962135,0.943523634131369,0.948044009779951,0.951681957186545,0.956733698964046,0.960486322188450,0.962401455427532,
    0.961933534743202,0.960890493381468,0.957382953181273,0.952009598080384,0.946706586826347,0.942446043165468,0.937088076692630,0.933413317336533,0.927971188475390,0.925614877024595,
    0.924324324324324,0.922155688622754,0.921697549312612,0.920454545454545,0.918562874251497,0.917668269230769,0.915151515151515,0.914477703115455,0.912162162162162,0.910438542310068,
    0.908695652173913,0.907557776389756,0.905031446540880,0.903409090909091,0.903225806451613,0.902408111533587,0.901587301587302,0.900254129606099,0.899491094147583,0.898661567877629,
    0.898218829516539,0.898348157560356,0.898983481575604,0.897208121827411,0.897012078830261,0.896551724137931,0.896353166986564,0.895646606914213,0.894230769230769,0.893316195372751,
    0.893919793014230,0.893464052287582,0.892480211081794,0.891478029294274,0.891129032258065,0.890243902439024,0.889876880984952,0.888812628689087,0.889117043121150,0.887228260869565,
    0.887542087542088,0.886666666666667,0.885883905013193,0.884840598568640,0.884048686739270,0.884542586750789,0.883374689826303,0.881779402803169,0.881294964028777,0.881275841701122,
    0.880396732788798,0.879699248120301,0.879032258064516,0.878346915017462,0.877917414721724,0.876951905059338,0.876863253402463,0.876973684210526,0.876234364713627,0.877645502645503,
    0.877181208053691,0.876997915218902,0.876911871813547,0.876233864844343,0.876065065840434,0.877343750000000,0.877261998426436,0.877567140600316,0.879242304656669,0.879120879120879,
    0.880187940485513,0.879000780640125,0.880748246297740,0.880562060889930,0.880000000000000,0.878740157480315,0.879936808846761,0.879936808846761,0.877470355731225,0.877583465818760,
    0.878812199036918,0.878444084278768,0.878589007383101,0.880000000000000,0.879222972972973,0.881646655231561,0.879025239338555,0.877425044091711,0.878026905829596,0.879326047358834,
    0.878228782287823,0.879813084112150,0.877924528301887,0.879254302103250,0.881292189006750,0.882330097087379,0.881445312500000,0.882859941234084,0.884774066797643,0.886922320550639,
    0.884720861900098,0.885087719298246,0.887390882638215,0.888331726133076,0.887238095238095,0.887641509433962,0.886928104575164,0.887661141804788,0.886660617059891,0.888440860215054,
    0.888692579505300,0.888307155322862,0.889655172413793,0.890971039182283,0.888235294117647,0.886949293433084,0.887973640856672,0.889525368248773,0.890243902439024,0.889789303079417,
    0.890234059725585,0.890410958904110,0.891216760676874,0.893462469733656,0.888173773129525,0.893117408906883,0.891233766233766,0.891781936533767,0.892068683565004,0.891803278688525,
    0.892181069958848,0.893951946975974,0.893775933609959,0.893244370308590,0.891959798994975,0.895939086294416,0.893887945670628,0.892887746358183,0.892547660311958,0.889667250437828,
    0.891438658428950,0.887025595763460,0.884784520668426,0.888498683055312,0.888111888111888,0.880104257167680,0.880312228967910,0.878111587982833,0.881950384944397,0.869897959183674,
    0.875634517766497,0.874894336432798,0.873322147651007,0.869891576313595,0.864730290456432,0.857963875205255,0.853758169934640,0.849270664505673,0.847389558232932,0.845786963434022,
    0.839874411302983};

const Float eSFRSPD_bg[nESFRSamples] = {0.267369830905743,0.276661040355992,0.284426921993805,0.290636608172153,0.297029702970297,0.306679828891083,0.313743589743590,0.323210831721470,0.333363970588235,0.345414847161572,
    0.355000000000000,0.372990353697749,0.388529638183218,0.407047477744807,0.427469358327325,0.443952180028129,0.459835503769705,0.472488199595415,0.481921280853903,0.488266315095583,
    0.492546986390149,0.495480585614258,0.497758405977584,0.499693627450980,0.501817080557238,0.503311258278146,0.506445783132530,0.509532374100719,0.511476389719068,0.513460393091126,
    0.514472123368921,0.515425531914894,0.515615792575133,0.514041297935103,0.513604240282686,0.512197996464349,0.510895170789164,0.510424028268551,0.509952885747939,0.509294117647059,
    0.508225616921269,0.507494145199063,0.507764156450671,0.507997664915353,0.508060747663551,0.508035190615836,0.508165680473373,0.507806912991657,0.508093525179856,0.508438818565401,
    0.508848484848485,0.509445460085314,0.511656441717792,0.515104808877929,0.518580246913580,0.523685837971552,0.529510229386237,0.534223602484472,0.539116915422886,0.544791016843419,
    0.547260273972603,0.549191542288557,0.549006211180124,0.546679081315953,0.542563783447418,0.537085678549093,0.530156739811912,0.522787193973635,0.515283018867925,0.508259773013871,
    0.502091254752852,0.497373478539398,0.494311570782159,0.492889758643183,0.492302631578947,0.493037135278515,0.495716198125837,0.496776359973136,0.498928332217013,0.499534264803726,
    0.498615688859591,0.495819725669497,0.491149870801034,0.484639898024219,0.478252671275927,0.471640866873065,0.464351005484461,0.458033573141487,0.452830188679245,0.450523255813954,
    0.448994830557151,0.450000000000000,0.452524106636415,0.456848137535817,0.461624484991171,0.466155732679338,0.472218690400509,0.476694641704325,0.482600258732212,0.486688311688312,
    0.490184453227932,0.491967324710688,0.494012829650748,0.495913818722140,0.497424242424242,0.497935779816514,0.497536566589684,0.496061776061776,0.495752895752896,0.495688991531948,
    0.493328220858896,0.491736801836266,0.490610687022901,0.489304812834225,0.488700999231360,0.487808641975309,0.486553323029366,0.486774941995360,0.487848297213622,0.486790986790987,
    0.487548942834769,0.488765822784810,0.490160000000000,0.490194489465154,0.490625000000000,0.491500000000000,0.491976351351351,0.493071000855432,0.494956521739130,0.495682819383260,
    0.498305084745763,0.501627486437613,0.503839122486289,0.507222222222222,0.511577964519141,0.515211267605634,0.518809073724008,0.524216524216524,0.527836034318398,0.532602478551001,
    0.536476190476190,0.536931818181818,0.541438032166509,0.542401500938086,0.544268406337372,0.544792626728111,0.545985401459854,0.545938628158845,0.544977777777778,0.545606326889280,
    0.544839549002602,0.544606164383562,0.541081994928149,0.537364470391993,0.536026380873866,0.535399673735726,0.532956381260097,0.529887820512821,0.527207637231504,0.523515439429929,
    0.520820189274448,0.518582677165354,0.517716535433071,0.516496465043205,0.514893617021277,0.513417521704815,0.514296998420221,0.517511885895404,0.520445505171042,0.523843700159490,
    0.529360000000000,0.537198067632850,0.540920096852300,0.547692307692308,0.554597233523190,0.564648117839607,0.570559210526316,0.580984153461218,0.590648694187026,0.601959114139693,
    0.610702054794521,0.619039451114923,0.628608247422680,0.641060735671514,0.648252344416027,0.656429780033841,0.664080944350759,0.679177162048699,0.680852842809365,0.689700996677741,
    0.689282769991756,0.700082372322900,0.697950819672131,0.703685503685504,0.695613322502031,0.701774193548387,0.706114239742558,0.708901363271852,0.706502775574941,0.704769351055512,
    0.697900466562986};// background

const Float eSFRSPD_bg_bd[nESFRSamples] = {0.0159389635896661,0.0212656467315716,0.0202825947334618,0.0177546924802267,0.0209997817070509,0.0196589052287582,0.0190804597701149,0.0201541251133273,0.0232582322357019,0.0230280528052805,
    0.0220206022187005,0.0222953328232594,0.0205743740795287,0.0213869132290185,0.0213683483068417,0.0222327469553451,0.0217514871116986,0.0216764514024788,0.0223818770226537,0.0205705128205128,
    0.0209286165508528,0.0213461538461538,0.0217861482381531,0.0212313209802750,0.0203489059727972,0.0205008839127873,0.0210147492625369,0.0208946439081813,0.0203699354081034,0.0198826979472141,
    0.0201988304093567,0.0206705539358601,0.0204079254079254,0.0203857393337230,0.0201811805961426,0.0205038078500293,0.0202227432590856,0.0205399061032864,0.0203403755868545,0.0207394366197183,
    0.0207737397420868,0.0205084745762712,0.0207109557109557,0.0206293706293706,0.0206122448979592,0.0208553016988869,0.0211636148848198,0.0214030915576694,0.0213217703349282,0.0215084134615385,
    0.0218115942028986,0.0219975713418336,0.0219719169719170,0.0223865030674847,0.0221723076923077,0.0230129390018484,0.0232674490426189,0.0229437229437229,0.0229721362229102,0.0225728456292622,
    0.0231064356435644,0.0237554045707227,0.0228024691358025,0.0228421701602959,0.0231130327362569,0.0234944237918216,0.0236211180124224,0.0237080745341615,0.0237911746426352,0.0234869240348692,
    0.0233771106941839,0.0236449778900821,0.0235946462715105,0.0236012861736334,0.0235454545454545,0.0237131630648330,0.0232914738929280,0.0230325149303251,0.0236946463978850,0.0237729658792651,
    0.0239232270657124,0.0235009671179884,0.0237332482450542,0.0231486146095718,0.0232278088144010,0.0236024464831804,0.0236762936221420,0.0238616203429923,0.0236046511627907,0.0238258877434135,
    0.0239479638009050,0.0237331838565022,0.0241261864879955,0.0241464788732394,0.0239837869137232,0.0242623941958888,0.0245574387947269,0.0249617834394905,0.0239808917197452,0.0243103448275862,
    0.0242163212435233,0.0244735077129443,0.0240857946554149,0.0246622613803231,0.0245848915482423,0.0249058025621703,0.0252431610942249,0.0248514851485149,0.0242748671222475,0.0251812688821752,
    0.0249924924924925,0.0249401197604790,0.0250709484690067,0.0256170531039641,0.0253308270676692,0.0243990929705215,0.0249166666666667,0.0257316148597422,0.0242149390243902,0.0248466257668712,
    0.0252167182662539,0.0246671887235709,0.0244329896907217,0.0248670427074940,0.0248442622950820,0.0242262895174709,0.0263682432432432,0.0259691252144082,0.0240559440559441,0.0248579040852575,
    0.0253866906474820,0.0263570127504554,0.0257103321033210,0.0268097014925373,0.0269454887218045,0.0272264150943396,0.0274502369668246,0.0272476190476191,0.0278360343183985,0.0280056980056980,
    0.0283806818181818,0.0284745762711864,0.0285861423220974,0.0267161410018553,0.0278001833180568,0.0285494106980961,0.0284780662488809,0.0282950530035336,0.0284581881533101,0.0281716738197425,
    0.0275254237288136,0.0285129490392648,0.0296033057851240,0.0287938060309698,0.0274818986323411,0.0268814638027049,0.0266587864460205,0.0267240031274433,0.0277120622568093,0.0274825716498838,
    0.0269792467332821,0.0276212471131640,0.0256009244992296,0.0256802459646426,0.0261171032357473,0.0261389961389961,0.0272924747866563,0.0267288267288267,0.0260998439937598,0.0285356303837118,
    0.0278240377062058,0.0298817966903073,0.0296439873417722,0.0320047732696897,0.0306084867894315,0.0290104585679807,0.0275404530744337,0.0279197379197379,0.0274771784232365,0.0307885906040268,
    0.0311486486486487,0.0332516891891892,0.0329570345408593,0.0312447434819176,0.0364033613445378,0.0321333333333333,0.0364871582435791,0.0321192052980132,0.0338196721311475,0.0377995110024450,
    0.0389169381107492,0.0357886178861789,0.0355141700404858,0.0411244979919679,0.0347801758593126,0.0388782816229117,0.0393201581027668,0.0313070866141732,0.0356186770428016,0.0357979953739399,
    0.0438420245398773};// black dot

const Float eSFRSPD_bg_sq[nESFRSamples] = {0.102781501340483,0.103784033225658,0.104306220095694,0.111481291645310,0.111820219417247,0.115266168059833,0.117272540562744,0.120522749273959,0.125114995400184,0.124694589877836,
    0.129180602006689,0.131642512077295,0.133436293436293,0.137323420074349,0.141991341991342,0.145672061928220,0.149074708704592,0.151956815114710,0.153666666666667,0.154059405940594,
    0.156290531776913,0.157680050987890,0.158478802992519,0.158675659104844,0.159115687462144,0.160120481927711,0.160699216395419,0.162027594481104,0.163016157989228,0.164579606440072,
    0.165459940652819,0.166075650118203,0.167040094339623,0.166686320754717,0.166882734236889,0.167511792452830,0.167785630153121,0.167962308598351,0.168157739846969,0.168489124044680,
    0.168918918918919,0.169361452841242,0.169567757009346,0.169626168224299,0.170509069631363,0.170581327069877,0.171343990526939,0.172434367541766,0.173333333333333,0.173429951690821,
    0.174696601941748,0.176068376068376,0.177225291589933,0.179506172839506,0.182189239332097,0.184119106699752,0.185767557489124,0.188550093341630,0.190523690773067,0.192129918800750,
    0.192701185277604,0.192901618929016,0.192154420921544,0.190796019900498,0.189034267912773,0.185982478097622,0.182810539523212,0.179711055276382,0.176526117054751,0.173817034700315,
    0.171238095238095,0.168120590121873,0.166752910737387,0.166100587851078,0.166381015161503,0.166976744186047,0.168297587131367,0.169380888290713,0.170000000000000,0.170686209193871,
    0.170852610707204,0.170222513089005,0.168284789644013,0.165389527458493,0.162366268093140,0.159454432734036,0.156707317073171,0.154316546762590,0.152037802717070,0.151338766006985,
    0.151178838412881,0.151368301026226,0.152784090909091,0.154587155963303,0.156091818716892,0.158527607361963,0.161425843411840,0.163477698771816,0.165242718446602,0.167186484730344,
    0.168271767810026,0.169734151329243,0.170135424091233,0.170824053452116,0.171038665655800,0.171614384085692,0.171703932151118,0.170510835913313,0.170146945088940,0.169822940723634,
    0.167818740399386,0.165977011494253,0.166207951070336,0.165237366003063,0.164846153846154,0.163706563706564,0.163390092879257,0.164810518174787,0.163671572424477,0.164641744548287,
    0.164050235478807,0.164789849325932,0.164931945556445,0.165881397238018,0.165568369028007,0.166277128547579,0.167823878069433,0.167037671232877,0.168929503916449,0.169902912621359,
    0.169588550983900,0.171739130434783,0.172827081427264,0.175324675324675,0.177289719626168,0.179209783631232,0.181835383159886,0.184000000000000,0.185877862595420,0.190066857688634,
    0.190935114503817,0.192197906755471,0.194112060778727,0.195000000000000,0.196261682242991,0.196947271045328,0.195146520146520,0.195397111913357,0.194369973190349,0.192951541850220,
    0.195553618134263,0.193981083404987,0.194472789115646,0.192275398824517,0.191210613598673,0.191639344262295,0.188555194805195,0.188083735909823,0.186240000000000,0.185146942017474,
    0.184189723320158,0.183162055335968,0.181739130434783,0.182913385826772,0.182176656151420,0.182399368587214,0.182515822784810,0.185612082670906,0.186044657097289,0.190457097032879,
    0.191084337349398,0.195893719806763,0.197016129032258,0.201219512195122,0.204987735077678,0.209515996718622,0.214698596201486,0.220150501672241,0.228462192013594,0.232649572649573,
    0.237113402061856,0.243944636678201,0.249871023215821,0.250898203592814,0.258083832335329,0.266666666666667,0.268813559322034,0.273395270270270,0.274832214765101,0.282362728785358,
    0.291597337770383,0.296856906534326,0.297199341021417,0.300327600327600,0.303150242326333,0.300642054574639,0.300480000000000,0.299286280729580,0.297963978073610,0.299533799533800,
    0.298468606431853};// square
// --------------------
    
const Float CIE_X[nCIESamples] = {
    // CIE X function values
    0.0001299000f,   0.0001458470f,   0.0001638021f,   0.0001840037f,
    0.0002066902f,   0.0002321000f,   0.0002607280f,   0.0002930750f,
    0.0003293880f,   0.0003699140f,   0.0004149000f,   0.0004641587f,
    0.0005189860f,   0.0005818540f,   0.0006552347f,   0.0007416000f,
    0.0008450296f,   0.0009645268f,   0.001094949f,    0.001231154f,
    0.001368000f,    0.001502050f,    0.001642328f,    0.001802382f,
    0.001995757f,    0.002236000f,    0.002535385f,    0.002892603f,
    0.003300829f,    0.003753236f,    0.004243000f,    0.004762389f,
    0.005330048f,    0.005978712f,    0.006741117f,    0.007650000f,
    0.008751373f,    0.01002888f,     0.01142170f,     0.01286901f,
    0.01431000f,     0.01570443f,     0.01714744f,     0.01878122f,
    0.02074801f,     0.02319000f,     0.02620736f,     0.02978248f,
    0.03388092f,     0.03846824f,     0.04351000f,     0.04899560f,
    0.05502260f,     0.06171880f,     0.06921200f,     0.07763000f,
    0.08695811f,     0.09717672f,     0.1084063f,      0.1207672f,
    0.1343800f,      0.1493582f,      0.1653957f,      0.1819831f,
    0.1986110f,      0.2147700f,      0.2301868f,      0.2448797f,
    0.2587773f,      0.2718079f,      0.2839000f,      0.2949438f,
    0.3048965f,      0.3137873f,      0.3216454f,      0.3285000f,
    0.3343513f,      0.3392101f,      0.3431213f,      0.3461296f,
    0.3482800f,      0.3495999f,      0.3501474f,      0.3500130f,
    0.3492870f,      0.3480600f,      0.3463733f,      0.3442624f,
    0.3418088f,      0.3390941f,      0.3362000f,      0.3331977f,
    0.3300411f,      0.3266357f,      0.3228868f,      0.3187000f,
    0.3140251f,      0.3088840f,      0.3032904f,      0.2972579f,
    0.2908000f,      0.2839701f,      0.2767214f,      0.2689178f,
    0.2604227f,      0.2511000f,      0.2408475f,      0.2298512f,
    0.2184072f,      0.2068115f,      0.1953600f,      0.1842136f,
    0.1733273f,      0.1626881f,      0.1522833f,      0.1421000f,
    0.1321786f,      0.1225696f,      0.1132752f,      0.1042979f,
    0.09564000f,     0.08729955f,     0.07930804f,     0.07171776f,
    0.06458099f,     0.05795001f,     0.05186211f,     0.04628152f,
    0.04115088f,     0.03641283f,     0.03201000f,     0.02791720f,
    0.02414440f,     0.02068700f,     0.01754040f,     0.01470000f,
    0.01216179f,     0.009919960f,    0.007967240f,    0.006296346f,
    0.004900000f,    0.003777173f,    0.002945320f,    0.002424880f,
    0.002236293f,    0.002400000f,    0.002925520f,    0.003836560f,
    0.005174840f,    0.006982080f,    0.009300000f,    0.01214949f,
    0.01553588f,     0.01947752f,     0.02399277f,     0.02910000f,
    0.03481485f,     0.04112016f,     0.04798504f,     0.05537861f,
    0.06327000f,     0.07163501f,     0.08046224f,     0.08973996f,
    0.09945645f,     0.1096000f,      0.1201674f,      0.1311145f,
    0.1423679f,      0.1538542f,      0.1655000f,      0.1772571f,
    0.1891400f,      0.2011694f,      0.2133658f,      0.2257499f,
    0.2383209f,      0.2510668f,      0.2639922f,      0.2771017f,
    0.2904000f,      0.3038912f,      0.3175726f,      0.3314384f,
    0.3454828f,      0.3597000f,      0.3740839f,      0.3886396f,
    0.4033784f,      0.4183115f,      0.4334499f,      0.4487953f,
    0.4643360f,      0.4800640f,      0.4959713f,      0.5120501f,
    0.5282959f,      0.5446916f,      0.5612094f,      0.5778215f,
    0.5945000f,      0.6112209f,      0.6279758f,      0.6447602f,
    0.6615697f,      0.6784000f,      0.6952392f,      0.7120586f,
    0.7288284f,      0.7455188f,      0.7621000f,      0.7785432f,
    0.7948256f,      0.8109264f,      0.8268248f,      0.8425000f,
    0.8579325f,      0.8730816f,      0.8878944f,      0.9023181f,
    0.9163000f,      0.9297995f,      0.9427984f,      0.9552776f,
    0.9672179f,      0.9786000f,      0.9893856f,      0.9995488f,
    1.0090892f,      1.0180064f,      1.0263000f,      1.0339827f,
    1.0409860f,      1.0471880f,      1.0524667f,      1.0567000f,
    1.0597944f,      1.0617992f,      1.0628068f,      1.0629096f,
    1.0622000f,      1.0607352f,      1.0584436f,      1.0552244f,
    1.0509768f,      1.0456000f,      1.0390369f,      1.0313608f,
    1.0226662f,      1.0130477f,      1.0026000f,      0.9913675f,
    0.9793314f,      0.9664916f,      0.9528479f,      0.9384000f,
    0.9231940f,      0.9072440f,      0.8905020f,      0.8729200f,
    0.8544499f,      0.8350840f,      0.8149460f,      0.7941860f,
    0.7729540f,      0.7514000f,      0.7295836f,      0.7075888f,
    0.6856022f,      0.6638104f,      0.6424000f,      0.6215149f,
    0.6011138f,      0.5811052f,      0.5613977f,      0.5419000f,
    0.5225995f,      0.5035464f,      0.4847436f,      0.4661939f,
    0.4479000f,      0.4298613f,      0.4120980f,      0.3946440f,
    0.3775333f,      0.3608000f,      0.3444563f,      0.3285168f,
    0.3130192f,      0.2980011f,      0.2835000f,      0.2695448f,
    0.2561184f,      0.2431896f,      0.2307272f,      0.2187000f,
    0.2070971f,      0.1959232f,      0.1851708f,      0.1748323f,
    0.1649000f,      0.1553667f,      0.1462300f,      0.1374900f,
    0.1291467f,      0.1212000f,      0.1136397f,      0.1064650f,
    0.09969044f,     0.09333061f,     0.08740000f,     0.08190096f,
    0.07680428f,     0.07207712f,     0.06768664f,     0.06360000f,
    0.05980685f,     0.05628216f,     0.05297104f,     0.04981861f,
    0.04677000f,     0.04378405f,     0.04087536f,     0.03807264f,
    0.03540461f,     0.03290000f,     0.03056419f,     0.02838056f,
    0.02634484f,     0.02445275f,     0.02270000f,     0.02108429f,
    0.01959988f,     0.01823732f,     0.01698717f,     0.01584000f,
    0.01479064f,     0.01383132f,     0.01294868f,     0.01212920f,
    0.01135916f,     0.01062935f,     0.009938846f,    0.009288422f,
    0.008678854f,    0.008110916f,    0.007582388f,    0.007088746f,
    0.006627313f,    0.006195408f,    0.005790346f,    0.005409826f,
    0.005052583f,    0.004717512f,    0.004403507f,    0.004109457f,
    0.003833913f,    0.003575748f,    0.003334342f,    0.003109075f,
    0.002899327f,    0.002704348f,    0.002523020f,    0.002354168f,
    0.002196616f,    0.002049190f,    0.001910960f,    0.001781438f,
    0.001660110f,    0.001546459f,    0.001439971f,    0.001340042f,
    0.001246275f,    0.001158471f,    0.001076430f,    0.0009999493f,
    0.0009287358f,   0.0008624332f,   0.0008007503f,   0.0007433960f,
    0.0006900786f,   0.0006405156f,   0.0005945021f,   0.0005518646f,
    0.0005124290f,   0.0004760213f,   0.0004424536f,   0.0004115117f,
    0.0003829814f,   0.0003566491f,   0.0003323011f,   0.0003097586f,
    0.0002888871f,   0.0002695394f,   0.0002515682f,   0.0002348261f,
    0.0002191710f,   0.0002045258f,   0.0001908405f,   0.0001780654f,
    0.0001661505f,   0.0001550236f,   0.0001446219f,   0.0001349098f,
    0.0001258520f,   0.0001174130f,   0.0001095515f,   0.0001022245f,
    0.00009539445f,  0.00008902390f,  0.00008307527f,  0.00007751269f,
    0.00007231304f,  0.00006745778f,  0.00006292844f,  0.00005870652f,
    0.00005477028f,  0.00005109918f,  0.00004767654f,  0.00004448567f,
    0.00004150994f,  0.00003873324f,  0.00003614203f,  0.00003372352f,
    0.00003146487f,  0.00002935326f,  0.00002737573f,  0.00002552433f,
    0.00002379376f,  0.00002217870f,  0.00002067383f,  0.00001927226f,
    0.00001796640f,  0.00001674991f,  0.00001561648f,  0.00001455977f,
    0.00001357387f,  0.00001265436f,  0.00001179723f,  0.00001099844f,
    0.00001025398f,  0.000009559646f, 0.000008912044f, 0.000008308358f,
    0.000007745769f, 0.000007221456f, 0.000006732475f, 0.000006276423f,
    0.000005851304f, 0.000005455118f, 0.000005085868f, 0.000004741466f,
    0.000004420236f, 0.000004120783f, 0.000003841716f, 0.000003581652f,
    0.000003339127f, 0.000003112949f, 0.000002902121f, 0.000002705645f,
    0.000002522525f, 0.000002351726f, 0.000002192415f, 0.000002043902f,
    0.000001905497f, 0.000001776509f, 0.000001656215f, 0.000001544022f,
    0.000001439440f, 0.000001341977f, 0.000001251141f};

const Float CIE_Y[nCIESamples] = {
    // CIE Y function values
    0.000003917000f,  0.000004393581f,  0.000004929604f,  0.000005532136f,
    0.000006208245f,  0.000006965000f,  0.000007813219f,  0.000008767336f,
    0.000009839844f,  0.00001104323f,   0.00001239000f,   0.00001388641f,
    0.00001555728f,   0.00001744296f,   0.00001958375f,   0.00002202000f,
    0.00002483965f,   0.00002804126f,   0.00003153104f,   0.00003521521f,
    0.00003900000f,   0.00004282640f,   0.00004691460f,   0.00005158960f,
    0.00005717640f,   0.00006400000f,   0.00007234421f,   0.00008221224f,
    0.00009350816f,   0.0001061361f,    0.0001200000f,    0.0001349840f,
    0.0001514920f,    0.0001702080f,    0.0001918160f,    0.0002170000f,
    0.0002469067f,    0.0002812400f,    0.0003185200f,    0.0003572667f,
    0.0003960000f,    0.0004337147f,    0.0004730240f,    0.0005178760f,
    0.0005722187f,    0.0006400000f,    0.0007245600f,    0.0008255000f,
    0.0009411600f,    0.001069880f,     0.001210000f,     0.001362091f,
    0.001530752f,     0.001720368f,     0.001935323f,     0.002180000f,
    0.002454800f,     0.002764000f,     0.003117800f,     0.003526400f,
    0.004000000f,     0.004546240f,     0.005159320f,     0.005829280f,
    0.006546160f,     0.007300000f,     0.008086507f,     0.008908720f,
    0.009767680f,     0.01066443f,      0.01160000f,      0.01257317f,
    0.01358272f,      0.01462968f,      0.01571509f,      0.01684000f,
    0.01800736f,      0.01921448f,      0.02045392f,      0.02171824f,
    0.02300000f,      0.02429461f,      0.02561024f,      0.02695857f,
    0.02835125f,      0.02980000f,      0.03131083f,      0.03288368f,
    0.03452112f,      0.03622571f,      0.03800000f,      0.03984667f,
    0.04176800f,      0.04376600f,      0.04584267f,      0.04800000f,
    0.05024368f,      0.05257304f,      0.05498056f,      0.05745872f,
    0.06000000f,      0.06260197f,      0.06527752f,      0.06804208f,
    0.07091109f,      0.07390000f,      0.07701600f,      0.08026640f,
    0.08366680f,      0.08723280f,      0.09098000f,      0.09491755f,
    0.09904584f,      0.1033674f,       0.1078846f,       0.1126000f,
    0.1175320f,       0.1226744f,       0.1279928f,       0.1334528f,
    0.1390200f,       0.1446764f,       0.1504693f,       0.1564619f,
    0.1627177f,       0.1693000f,       0.1762431f,       0.1835581f,
    0.1912735f,       0.1994180f,       0.2080200f,       0.2171199f,
    0.2267345f,       0.2368571f,       0.2474812f,       0.2586000f,
    0.2701849f,       0.2822939f,       0.2950505f,       0.3085780f,
    0.3230000f,       0.3384021f,       0.3546858f,       0.3716986f,
    0.3892875f,       0.4073000f,       0.4256299f,       0.4443096f,
    0.4633944f,       0.4829395f,       0.5030000f,       0.5235693f,
    0.5445120f,       0.5656900f,       0.5869653f,       0.6082000f,
    0.6293456f,       0.6503068f,       0.6708752f,       0.6908424f,
    0.7100000f,       0.7281852f,       0.7454636f,       0.7619694f,
    0.7778368f,       0.7932000f,       0.8081104f,       0.8224962f,
    0.8363068f,       0.8494916f,       0.8620000f,       0.8738108f,
    0.8849624f,       0.8954936f,       0.9054432f,       0.9148501f,
    0.9237348f,       0.9320924f,       0.9399226f,       0.9472252f,
    0.9540000f,       0.9602561f,       0.9660074f,       0.9712606f,
    0.9760225f,       0.9803000f,       0.9840924f,       0.9874812f,
    0.9903128f,       0.9928116f,       0.9949501f,       0.9967108f,
    0.9980983f,       0.9991120f,       0.9997482f,       1.0000000f,
    0.9998567f,       0.9993046f,       0.9983255f,       0.9968987f,
    0.9950000f,       0.9926005f,       0.9897426f,       0.9864444f,
    0.9827241f,       0.9786000f,       0.9740837f,       0.9691712f,
    0.9638568f,       0.9581349f,       0.9520000f,       0.9454504f,
    0.9384992f,       0.9311628f,       0.9234576f,       0.9154000f,
    0.9070064f,       0.8982772f,       0.8892048f,       0.8797816f,
    0.8700000f,       0.8598613f,       0.8493920f,       0.8386220f,
    0.8275813f,       0.8163000f,       0.8047947f,       0.7930820f,
    0.7811920f,       0.7691547f,       0.7570000f,       0.7447541f,
    0.7324224f,       0.7200036f,       0.7074965f,       0.6949000f,
    0.6822192f,       0.6694716f,       0.6566744f,       0.6438448f,
    0.6310000f,       0.6181555f,       0.6053144f,       0.5924756f,
    0.5796379f,       0.5668000f,       0.5539611f,       0.5411372f,
    0.5283528f,       0.5156323f,       0.5030000f,       0.4904688f,
    0.4780304f,       0.4656776f,       0.4534032f,       0.4412000f,
    0.4290800f,       0.4170360f,       0.4050320f,       0.3930320f,
    0.3810000f,       0.3689184f,       0.3568272f,       0.3447768f,
    0.3328176f,       0.3210000f,       0.3093381f,       0.2978504f,
    0.2865936f,       0.2756245f,       0.2650000f,       0.2547632f,
    0.2448896f,       0.2353344f,       0.2260528f,       0.2170000f,
    0.2081616f,       0.1995488f,       0.1911552f,       0.1829744f,
    0.1750000f,       0.1672235f,       0.1596464f,       0.1522776f,
    0.1451259f,       0.1382000f,       0.1315003f,       0.1250248f,
    0.1187792f,       0.1127691f,       0.1070000f,       0.1014762f,
    0.09618864f,      0.09112296f,      0.08626485f,      0.08160000f,
    0.07712064f,      0.07282552f,      0.06871008f,      0.06476976f,
    0.06100000f,      0.05739621f,      0.05395504f,      0.05067376f,
    0.04754965f,      0.04458000f,      0.04175872f,      0.03908496f,
    0.03656384f,      0.03420048f,      0.03200000f,      0.02996261f,
    0.02807664f,      0.02632936f,      0.02470805f,      0.02320000f,
    0.02180077f,      0.02050112f,      0.01928108f,      0.01812069f,
    0.01700000f,      0.01590379f,      0.01483718f,      0.01381068f,
    0.01283478f,      0.01192000f,      0.01106831f,      0.01027339f,
    0.009533311f,     0.008846157f,     0.008210000f,     0.007623781f,
    0.007085424f,     0.006591476f,     0.006138485f,     0.005723000f,
    0.005343059f,     0.004995796f,     0.004676404f,     0.004380075f,
    0.004102000f,     0.003838453f,     0.003589099f,     0.003354219f,
    0.003134093f,     0.002929000f,     0.002738139f,     0.002559876f,
    0.002393244f,     0.002237275f,     0.002091000f,     0.001953587f,
    0.001824580f,     0.001703580f,     0.001590187f,     0.001484000f,
    0.001384496f,     0.001291268f,     0.001204092f,     0.001122744f,
    0.001047000f,     0.0009765896f,    0.0009111088f,    0.0008501332f,
    0.0007932384f,    0.0007400000f,    0.0006900827f,    0.0006433100f,
    0.0005994960f,    0.0005584547f,    0.0005200000f,    0.0004839136f,
    0.0004500528f,    0.0004183452f,    0.0003887184f,    0.0003611000f,
    0.0003353835f,    0.0003114404f,    0.0002891656f,    0.0002684539f,
    0.0002492000f,    0.0002313019f,    0.0002146856f,    0.0001992884f,
    0.0001850475f,    0.0001719000f,    0.0001597781f,    0.0001486044f,
    0.0001383016f,    0.0001287925f,    0.0001200000f,    0.0001118595f,
    0.0001043224f,    0.00009733560f,   0.00009084587f,   0.00008480000f,
    0.00007914667f,   0.00007385800f,   0.00006891600f,   0.00006430267f,
    0.00006000000f,   0.00005598187f,   0.00005222560f,   0.00004871840f,
    0.00004544747f,   0.00004240000f,   0.00003956104f,   0.00003691512f,
    0.00003444868f,   0.00003214816f,   0.00003000000f,   0.00002799125f,
    0.00002611356f,   0.00002436024f,   0.00002272461f,   0.00002120000f,
    0.00001977855f,   0.00001845285f,   0.00001721687f,   0.00001606459f,
    0.00001499000f,   0.00001398728f,   0.00001305155f,   0.00001217818f,
    0.00001136254f,   0.00001060000f,   0.000009885877f,  0.000009217304f,
    0.000008592362f,  0.000008009133f,  0.000007465700f,  0.000006959567f,
    0.000006487995f,  0.000006048699f,  0.000005639396f,  0.000005257800f,
    0.000004901771f,  0.000004569720f,  0.000004260194f,  0.000003971739f,
    0.000003702900f,  0.000003452163f,  0.000003218302f,  0.000003000300f,
    0.000002797139f,  0.000002607800f,  0.000002431220f,  0.000002266531f,
    0.000002113013f,  0.000001969943f,  0.000001836600f,  0.000001712230f,
    0.000001596228f,  0.000001488090f,  0.000001387314f,  0.000001293400f,
    0.000001205820f,  0.000001124143f,  0.000001048009f,  0.0000009770578f,
    0.0000009109300f, 0.0000008492513f, 0.0000007917212f, 0.0000007380904f,
    0.0000006881098f, 0.0000006415300f, 0.0000005980895f, 0.0000005575746f,
    0.0000005198080f, 0.0000004846123f, 0.0000004518100f};

const Float CIE_Z[nCIESamples] = {
    // CIE Z function values
    0.0006061000f,
    0.0006808792f,
    0.0007651456f,
    0.0008600124f,
    0.0009665928f,
    0.001086000f,
    0.001220586f,
    0.001372729f,
    0.001543579f,
    0.001734286f,
    0.001946000f,
    0.002177777f,
    0.002435809f,
    0.002731953f,
    0.003078064f,
    0.003486000f,
    0.003975227f,
    0.004540880f,
    0.005158320f,
    0.005802907f,
    0.006450001f,
    0.007083216f,
    0.007745488f,
    0.008501152f,
    0.009414544f,
    0.01054999f,
    0.01196580f,
    0.01365587f,
    0.01558805f,
    0.01773015f,
    0.02005001f,
    0.02251136f,
    0.02520288f,
    0.02827972f,
    0.03189704f,
    0.03621000f,
    0.04143771f,
    0.04750372f,
    0.05411988f,
    0.06099803f,
    0.06785001f,
    0.07448632f,
    0.08136156f,
    0.08915364f,
    0.09854048f,
    0.1102000f,
    0.1246133f,
    0.1417017f,
    0.1613035f,
    0.1832568f,
    0.2074000f,
    0.2336921f,
    0.2626114f,
    0.2947746f,
    0.3307985f,
    0.3713000f,
    0.4162091f,
    0.4654642f,
    0.5196948f,
    0.5795303f,
    0.6456000f,
    0.7184838f,
    0.7967133f,
    0.8778459f,
    0.9594390f,
    1.0390501f,
    1.1153673f,
    1.1884971f,
    1.2581233f,
    1.3239296f,
    1.3856000f,
    1.4426352f,
    1.4948035f,
    1.5421903f,
    1.5848807f,
    1.6229600f,
    1.6564048f,
    1.6852959f,
    1.7098745f,
    1.7303821f,
    1.7470600f,
    1.7600446f,
    1.7696233f,
    1.7762637f,
    1.7804334f,
    1.7826000f,
    1.7829682f,
    1.7816998f,
    1.7791982f,
    1.7758671f,
    1.7721100f,
    1.7682589f,
    1.7640390f,
    1.7589438f,
    1.7524663f,
    1.7441000f,
    1.7335595f,
    1.7208581f,
    1.7059369f,
    1.6887372f,
    1.6692000f,
    1.6475287f,
    1.6234127f,
    1.5960223f,
    1.5645280f,
    1.5281000f,
    1.4861114f,
    1.4395215f,
    1.3898799f,
    1.3387362f,
    1.2876400f,
    1.2374223f,
    1.1878243f,
    1.1387611f,
    1.0901480f,
    1.0419000f,
    0.9941976f,
    0.9473473f,
    0.9014531f,
    0.8566193f,
    0.8129501f,
    0.7705173f,
    0.7294448f,
    0.6899136f,
    0.6521049f,
    0.6162000f,
    0.5823286f,
    0.5504162f,
    0.5203376f,
    0.4919673f,
    0.4651800f,
    0.4399246f,
    0.4161836f,
    0.3938822f,
    0.3729459f,
    0.3533000f,
    0.3348578f,
    0.3175521f,
    0.3013375f,
    0.2861686f,
    0.2720000f,
    0.2588171f,
    0.2464838f,
    0.2347718f,
    0.2234533f,
    0.2123000f,
    0.2011692f,
    0.1901196f,
    0.1792254f,
    0.1685608f,
    0.1582000f,
    0.1481383f,
    0.1383758f,
    0.1289942f,
    0.1200751f,
    0.1117000f,
    0.1039048f,
    0.09666748f,
    0.08998272f,
    0.08384531f,
    0.07824999f,
    0.07320899f,
    0.06867816f,
    0.06456784f,
    0.06078835f,
    0.05725001f,
    0.05390435f,
    0.05074664f,
    0.04775276f,
    0.04489859f,
    0.04216000f,
    0.03950728f,
    0.03693564f,
    0.03445836f,
    0.03208872f,
    0.02984000f,
    0.02771181f,
    0.02569444f,
    0.02378716f,
    0.02198925f,
    0.02030000f,
    0.01871805f,
    0.01724036f,
    0.01586364f,
    0.01458461f,
    0.01340000f,
    0.01230723f,
    0.01130188f,
    0.01037792f,
    0.009529306f,
    0.008749999f,
    0.008035200f,
    0.007381600f,
    0.006785400f,
    0.006242800f,
    0.005749999f,
    0.005303600f,
    0.004899800f,
    0.004534200f,
    0.004202400f,
    0.003900000f,
    0.003623200f,
    0.003370600f,
    0.003141400f,
    0.002934800f,
    0.002749999f,
    0.002585200f,
    0.002438600f,
    0.002309400f,
    0.002196800f,
    0.002100000f,
    0.002017733f,
    0.001948200f,
    0.001889800f,
    0.001840933f,
    0.001800000f,
    0.001766267f,
    0.001737800f,
    0.001711200f,
    0.001683067f,
    0.001650001f,
    0.001610133f,
    0.001564400f,
    0.001513600f,
    0.001458533f,
    0.001400000f,
    0.001336667f,
    0.001270000f,
    0.001205000f,
    0.001146667f,
    0.001100000f,
    0.001068800f,
    0.001049400f,
    0.001035600f,
    0.001021200f,
    0.001000000f,
    0.0009686400f,
    0.0009299200f,
    0.0008868800f,
    0.0008425600f,
    0.0008000000f,
    0.0007609600f,
    0.0007236800f,
    0.0006859200f,
    0.0006454400f,
    0.0006000000f,
    0.0005478667f,
    0.0004916000f,
    0.0004354000f,
    0.0003834667f,
    0.0003400000f,
    0.0003072533f,
    0.0002831600f,
    0.0002654400f,
    0.0002518133f,
    0.0002400000f,
    0.0002295467f,
    0.0002206400f,
    0.0002119600f,
    0.0002021867f,
    0.0001900000f,
    0.0001742133f,
    0.0001556400f,
    0.0001359600f,
    0.0001168533f,
    0.0001000000f,
    0.00008613333f,
    0.00007460000f,
    0.00006500000f,
    0.00005693333f,
    0.00004999999f,
    0.00004416000f,
    0.00003948000f,
    0.00003572000f,
    0.00003264000f,
    0.00003000000f,
    0.00002765333f,
    0.00002556000f,
    0.00002364000f,
    0.00002181333f,
    0.00002000000f,
    0.00001813333f,
    0.00001620000f,
    0.00001420000f,
    0.00001213333f,
    0.00001000000f,
    0.000007733333f,
    0.000005400000f,
    0.000003200000f,
    0.000001333333f,
    0.000000000000f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f,
    0.0f};

const Float CIE_lambda[nCIESamples] = {
    360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374,
    375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389,
    390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404,
    405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419,
    420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434,
    435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449,
    450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464,
    465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475, 476, 477, 478, 479,
    480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 490, 491, 492, 493, 494,
    495, 496, 497, 498, 499, 500, 501, 502, 503, 504, 505, 506, 507, 508, 509,
    510, 511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 522, 523, 524,
    525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535, 536, 537, 538, 539,
    540, 541, 542, 543, 544, 545, 546, 547, 548, 549, 550, 551, 552, 553, 554,
    555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568, 569,
    570, 571, 572, 573, 574, 575, 576, 577, 578, 579, 580, 581, 582, 583, 584,
    585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599,
    600, 601, 602, 603, 604, 605, 606, 607, 608, 609, 610, 611, 612, 613, 614,
    615, 616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629,
    630, 631, 632, 633, 634, 635, 636, 637, 638, 639, 640, 641, 642, 643, 644,
    645, 646, 647, 648, 649, 650, 651, 652, 653, 654, 655, 656, 657, 658, 659,
    660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 672, 673, 674,
    675, 676, 677, 678, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 689,
    690, 691, 692, 693, 694, 695, 696, 697, 698, 699, 700, 701, 702, 703, 704,
    705, 706, 707, 708, 709, 710, 711, 712, 713, 714, 715, 716, 717, 718, 719,
    720, 721, 722, 723, 724, 725, 726, 727, 728, 729, 730, 731, 732, 733, 734,
    735, 736, 737, 738, 739, 740, 741, 742, 743, 744, 745, 746, 747, 748, 749,
    750, 751, 752, 753, 754, 755, 756, 757, 758, 759, 760, 761, 762, 763, 764,
    765, 766, 767, 768, 769, 770, 771, 772, 773, 774, 775, 776, 777, 778, 779,
    780, 781, 782, 783, 784, 785, 786, 787, 788, 789, 790, 791, 792, 793, 794,
    795, 796, 797, 798, 799, 800, 801, 802, 803, 804, 805, 806, 807, 808, 809,
    810, 811, 812, 813, 814, 815, 816, 817, 818, 819, 820, 821, 822, 823, 824,
    825, 826, 827, 828, 829, 830};
void Blackbody(const Float *lambda, int n, Float T, Float *Le) {
    if (T <= 0) {
        for (int i = 0; i < n; ++i) Le[i] = 0.f;
        return;
    }
    const Float c = 299792458;
    const Float h = 6.62606957e-34;
    const Float kb = 1.3806488e-23;
    for (int i = 0; i < n; ++i) {
        // Compute emitted radiance for blackbody at wavelength _lambda[i]_
        Float l = lambda[i] * 1e-9;
        Float lambda5 = (l * l) * (l * l) * l;
        Le[i] = (2 * h * c * c) /
                (lambda5 * (std::exp((h * c) / (l * kb * T)) - 1));
        CHECK(!std::isnan(Le[i]));
    }
}

void BlackbodyNormalized(const Float *lambda, int n, Float T, Float *Le) {
    Blackbody(lambda, n, T, Le);
    // Normalize _Le_ values based on maximum blackbody radiance
    Float lambdaMax = 2.8977721e-3 / T * 1e9;
    Float maxL;
    Blackbody(&lambdaMax, 1, T, &maxL);
    for (int i = 0; i < n; ++i) Le[i] /= maxL;
}

// Spectral Data Definitions
SampledSpectrum SampledSpectrum::X;
SampledSpectrum SampledSpectrum::Y;
SampledSpectrum SampledSpectrum::Z;
SampledSpectrum SampledSpectrum::R; // TL
SampledSpectrum SampledSpectrum::G; // TL
SampledSpectrum SampledSpectrum::B; // TL
// Zhenyi---------Start----------------
SampledSpectrum SampledSpectrum::eSFRPatch1;
SampledSpectrum SampledSpectrum::eSFRPatch2;
SampledSpectrum SampledSpectrum::eSFRPatch3;
SampledSpectrum SampledSpectrum::eSFRPatch4;
SampledSpectrum SampledSpectrum::eSFRPatch5;
SampledSpectrum SampledSpectrum::eSFRPatch6;
SampledSpectrum SampledSpectrum::eSFRPatch7;
SampledSpectrum SampledSpectrum::eSFRPatch8;
SampledSpectrum SampledSpectrum::eSFRPatch9;
SampledSpectrum SampledSpectrum::eSFRPatch10;
SampledSpectrum SampledSpectrum::eSFRPatch11;
SampledSpectrum SampledSpectrum::eSFRPatch12;
SampledSpectrum SampledSpectrum::eSFRPatch13;
SampledSpectrum SampledSpectrum::eSFRPatch14;
SampledSpectrum SampledSpectrum::eSFRPatch15;
SampledSpectrum SampledSpectrum::eSFRPatch16;
SampledSpectrum SampledSpectrum::eSFRPatch17;
SampledSpectrum SampledSpectrum::eSFRPatch18;
SampledSpectrum SampledSpectrum::eSFRPatch19;
SampledSpectrum SampledSpectrum::eSFRPatch20;
SampledSpectrum SampledSpectrum::eSFRBG;
SampledSpectrum SampledSpectrum::eSFRBG_BD;
SampledSpectrum SampledSpectrum::eSFRBG_SQ; 
// Zhenyi---------End----------------
SampledSpectrum SampledSpectrum::rgbRefl2SpectWhite;
SampledSpectrum SampledSpectrum::rgbRefl2SpectCyan;
SampledSpectrum SampledSpectrum::rgbRefl2SpectMagenta;
SampledSpectrum SampledSpectrum::rgbRefl2SpectYellow;
SampledSpectrum SampledSpectrum::rgbRefl2SpectRed;
SampledSpectrum SampledSpectrum::rgbRefl2SpectGreen;
SampledSpectrum SampledSpectrum::rgbRefl2SpectBlue;
SampledSpectrum SampledSpectrum::rgbIllum2SpectWhite;
SampledSpectrum SampledSpectrum::rgbIllum2SpectCyan;
SampledSpectrum SampledSpectrum::rgbIllum2SpectMagenta;
SampledSpectrum SampledSpectrum::rgbIllum2SpectYellow;
SampledSpectrum SampledSpectrum::rgbIllum2SpectRed;
SampledSpectrum SampledSpectrum::rgbIllum2SpectGreen;
SampledSpectrum SampledSpectrum::rgbIllum2SpectBlue;
const Float RGB2SpectLambda[nRGB2SpectSamples] = {
    380.000000, 390.967743, 401.935486, 412.903229, 423.870972, 434.838715,
    445.806458, 456.774200, 467.741943, 478.709686, 489.677429, 500.645172,
    511.612915, 522.580627, 533.548340, 544.516052, 555.483765, 566.451477,
    577.419189, 588.386902, 599.354614, 610.322327, 621.290039, 632.257751,
    643.225464, 654.193176, 665.160889, 676.128601, 687.096313, 698.064026,
    709.031738, 720.000000};

const Float RGBRefl2SpectWhite[nRGB2SpectSamples] = {
    1.0618958571272863e+00, 1.0615019980348779e+00, 1.0614335379927147e+00,
    1.0622711654692485e+00, 1.0622036218416742e+00, 1.0625059965187085e+00,
    1.0623938486985884e+00, 1.0624706448043137e+00, 1.0625048144827762e+00,
    1.0624366131308856e+00, 1.0620694238892607e+00, 1.0613167586932164e+00,
    1.0610334029377020e+00, 1.0613868564828413e+00, 1.0614215366116762e+00,
    1.0620336151299086e+00, 1.0625497454805051e+00, 1.0624317487992085e+00,
    1.0625249140554480e+00, 1.0624277664486914e+00, 1.0624749854090769e+00,
    1.0625538581025402e+00, 1.0625326910104864e+00, 1.0623922312225325e+00,
    1.0623650980354129e+00, 1.0625256476715284e+00, 1.0612277619533155e+00,
    1.0594262608698046e+00, 1.0599810758292072e+00, 1.0602547314449409e+00,
    1.0601263046243634e+00, 1.0606565756823634e+00};

const Float RGBRefl2SpectCyan[nRGB2SpectSamples] = {
    1.0414628021426751e+00,  1.0328661533771188e+00,  1.0126146228964314e+00,
    1.0350460524836209e+00,  1.0078661447098567e+00,  1.0422280385081280e+00,
    1.0442596738499825e+00,  1.0535238290294409e+00,  1.0180776226938120e+00,
    1.0442729908727713e+00,  1.0529362541920750e+00,  1.0537034271160244e+00,
    1.0533901869215969e+00,  1.0537782700979574e+00,  1.0527093770467102e+00,
    1.0530449040446797e+00,  1.0550554640191208e+00,  1.0553673610724821e+00,
    1.0454306634683976e+00,  6.2348950639230805e-01,  1.8038071613188977e-01,
    -7.6303759201984539e-03, -1.5217847035781367e-04, -7.5102257347258311e-03,
    -2.1708639328491472e-03, 6.5919466602369636e-04,  1.2278815318539780e-02,
    -4.4669775637208031e-03, 1.7119799082865147e-02,  4.9211089759759801e-03,
    5.8762925143334985e-03,  2.5259399415550079e-02};

const Float RGBRefl2SpectMagenta[nRGB2SpectSamples] = {
    9.9422138151236850e-01,  9.8986937122975682e-01, 9.8293658286116958e-01,
    9.9627868399859310e-01,  1.0198955019000133e+00, 1.0166395501210359e+00,
    1.0220913178757398e+00,  9.9651666040682441e-01, 1.0097766178917882e+00,
    1.0215422470827016e+00,  6.4031953387790963e-01, 2.5012379477078184e-03,
    6.5339939555769944e-03,  2.8334080462675826e-03, -5.1209675389074505e-11,
    -9.0592291646646381e-03, 3.3936718323331200e-03, -3.0638741121828406e-03,
    2.2203936168286292e-01,  6.3141140024811970e-01, 9.7480985576500956e-01,
    9.7209562333590571e-01,  1.0173770302868150e+00, 9.9875194322734129e-01,
    9.4701725739602238e-01,  8.5258623154354796e-01, 9.4897798581660842e-01,
    9.4751876096521492e-01,  9.9598944191059791e-01, 8.6301351503809076e-01,
    8.9150987853523145e-01,  8.4866492652845082e-01};

const Float RGBRefl2SpectYellow[nRGB2SpectSamples] = {
    5.5740622924920873e-03,  -4.7982831631446787e-03, -5.2536564298613798e-03,
    -6.4571480044499710e-03, -5.9693514658007013e-03, -2.1836716037686721e-03,
    1.6781120601055327e-02,  9.6096355429062641e-02,  2.1217357081986446e-01,
    3.6169133290685068e-01,  5.3961011543232529e-01,  7.4408810492171507e-01,
    9.2209571148394054e-01,  1.0460304298411225e+00,  1.0513824989063714e+00,
    1.0511991822135085e+00,  1.0510530911991052e+00,  1.0517397230360510e+00,
    1.0516043086790485e+00,  1.0511944032061460e+00,  1.0511590325868068e+00,
    1.0516612465483031e+00,  1.0514038526836869e+00,  1.0515941029228475e+00,
    1.0511460436960840e+00,  1.0515123758830476e+00,  1.0508871369510702e+00,
    1.0508923708102380e+00,  1.0477492815668303e+00,  1.0493272144017338e+00,
    1.0435963333422726e+00,  1.0392280772051465e+00};

const Float RGBRefl2SpectRed[nRGB2SpectSamples] = {
    1.6575604867086180e-01,  1.1846442802747797e-01,  1.2408293329637447e-01,
    1.1371272058349924e-01,  7.8992434518899132e-02,  3.2205603593106549e-02,
    -1.0798365407877875e-02, 1.8051975516730392e-02,  5.3407196598730527e-03,
    1.3654918729501336e-02,  -5.9564213545642841e-03, -1.8444365067353252e-03,
    -1.0571884361529504e-02, -2.9375521078000011e-03, -1.0790476271835936e-02,
    -8.0224306697503633e-03, -2.2669167702495940e-03, 7.0200240494706634e-03,
    -8.1528469000299308e-03, 6.0772866969252792e-01,  9.8831560865432400e-01,
    9.9391691044078823e-01,  1.0039338994753197e+00,  9.9234499861167125e-01,
    9.9926530858855522e-01,  1.0084621557617270e+00,  9.8358296827441216e-01,
    1.0085023660099048e+00,  9.7451138326568698e-01,  9.8543269570059944e-01,
    9.3495763980962043e-01,  9.8713907792319400e-01};

const Float RGBRefl2SpectGreen[nRGB2SpectSamples] = {
    2.6494153587602255e-03,  -5.0175013429732242e-03, -1.2547236272489583e-02,
    -9.4554964308388671e-03, -1.2526086181600525e-02, -7.9170697760437767e-03,
    -7.9955735204175690e-03, -9.3559433444469070e-03, 6.5468611982999303e-02,
    3.9572875517634137e-01,  7.5244022299886659e-01,  9.6376478690218559e-01,
    9.9854433855162328e-01,  9.9992977025287921e-01,  9.9939086751140449e-01,
    9.9994372267071396e-01,  9.9939121813418674e-01,  9.9911237310424483e-01,
    9.6019584878271580e-01,  6.3186279338432438e-01,  2.5797401028763473e-01,
    9.4014888527335638e-03,  -3.0798345608649747e-03, -4.5230367033685034e-03,
    -6.8933410388274038e-03, -9.0352195539015398e-03, -8.5913667165340209e-03,
    -8.3690869120289398e-03, -7.8685832338754313e-03, -8.3657578711085132e-06,
    5.4301225442817177e-03,  -2.7745589759259194e-03};

const Float RGBRefl2SpectBlue[nRGB2SpectSamples] = {
    9.9209771469720676e-01,  9.8876426059369127e-01,  9.9539040744505636e-01,
    9.9529317353008218e-01,  9.9181447411633950e-01,  1.0002584039673432e+00,
    9.9968478437342512e-01,  9.9988120766657174e-01,  9.8504012146370434e-01,
    7.9029849053031276e-01,  5.6082198617463974e-01,  3.3133458513996528e-01,
    1.3692410840839175e-01,  1.8914906559664151e-02,  -5.1129770932550889e-06,
    -4.2395493167891873e-04, -4.1934593101534273e-04, 1.7473028136486615e-03,
    3.7999160177631316e-03,  -5.5101474906588642e-04, -4.3716662898480967e-05,
    7.5874501748732798e-03,  2.5795650780554021e-02,  3.8168376532500548e-02,
    4.9489586408030833e-02,  4.9595992290102905e-02,  4.9814819505812249e-02,
    3.9840911064978023e-02,  3.0501024937233868e-02,  2.1243054765241080e-02,
    6.9596532104356399e-03,  4.1733649330980525e-03};
const Float RGBIllum2SpectWhite[nRGB2SpectSamples] = {
    1.1565232050369776e+00, 1.1567225000119139e+00, 1.1566203150243823e+00,
    1.1555782088080084e+00, 1.1562175509215700e+00, 1.1567674012207332e+00,
    1.1568023194808630e+00, 1.1567677445485520e+00, 1.1563563182952830e+00,
    1.1567054702510189e+00, 1.1565134139372772e+00, 1.1564336176499312e+00,
    1.1568023181530034e+00, 1.1473147688514642e+00, 1.1339317140561065e+00,
    1.1293876490671435e+00, 1.1290515328639648e+00, 1.0504864823782283e+00,
    1.0459696042230884e+00, 9.9366687168595691e-01, 9.5601669265393940e-01,
    9.2467482033511805e-01, 9.1499944702051761e-01, 8.9939467658453465e-01,
    8.9542520751331112e-01, 8.8870566693814745e-01, 8.8222843814228114e-01,
    8.7998311373826676e-01, 8.7635244612244578e-01, 8.8000368331709111e-01,
    8.8065665428441120e-01, 8.8304706460276905e-01};

const Float RGBIllum2SpectCyan[nRGB2SpectSamples] = {
    1.1334479663682135e+00,  1.1266762330194116e+00,  1.1346827504710164e+00,
    1.1357395805744794e+00,  1.1356371830149636e+00,  1.1361152989346193e+00,
    1.1362179057706772e+00,  1.1364819652587022e+00,  1.1355107110714324e+00,
    1.1364060941199556e+00,  1.1360363621722465e+00,  1.1360122641141395e+00,
    1.1354266882467030e+00,  1.1363099407179136e+00,  1.1355450412632506e+00,
    1.1353732327376378e+00,  1.1349496420726002e+00,  1.1111113947168556e+00,
    9.0598740429727143e-01,  6.1160780787465330e-01,  2.9539752170999634e-01,
    9.5954200671150097e-02,  -1.1650792030826267e-02, -1.2144633073395025e-02,
    -1.1148167569748318e-02, -1.1997606668458151e-02, -5.0506855475394852e-03,
    -7.9982745819542154e-03, -9.4722817708236418e-03, -5.5329541006658815e-03,
    -4.5428914028274488e-03, -1.2541015360921132e-02};

const Float RGBIllum2SpectMagenta[nRGB2SpectSamples] = {
    1.0371892935878366e+00,  1.0587542891035364e+00,  1.0767271213688903e+00,
    1.0762706844110288e+00,  1.0795289105258212e+00,  1.0743644742950074e+00,
    1.0727028691194342e+00,  1.0732447452056488e+00,  1.0823760816041414e+00,
    1.0840545681409282e+00,  9.5607567526306658e-01,  5.5197896855064665e-01,
    8.4191094887247575e-02,  8.7940070557041006e-05,  -2.3086408335071251e-03,
    -1.1248136628651192e-03, -7.7297612754989586e-11, -2.7270769006770834e-04,
    1.4466473094035592e-02,  2.5883116027169478e-01,  5.2907999827566732e-01,
    9.0966624097105164e-01,  1.0690571327307956e+00,  1.0887326064796272e+00,
    1.0637622289511852e+00,  1.0201812918094260e+00,  1.0262196688979945e+00,
    1.0783085560613190e+00,  9.8333849623218872e-01,  1.0707246342802621e+00,
    1.0634247770423768e+00,  1.0150875475729566e+00};

const Float RGBIllum2SpectYellow[nRGB2SpectSamples] = {
    2.7756958965811972e-03,  3.9673820990646612e-03,  -1.4606936788606750e-04,
    3.6198394557748065e-04,  -2.5819258699309733e-04, -5.0133191628082274e-05,
    -2.4437242866157116e-04, -7.8061419948038946e-05, 4.9690301207540921e-02,
    4.8515973574763166e-01,  1.0295725854360589e+00,  1.0333210878457741e+00,
    1.0368102644026933e+00,  1.0364884018886333e+00,  1.0365427939411784e+00,
    1.0368595402854539e+00,  1.0365645405660555e+00,  1.0363938240707142e+00,
    1.0367205578770746e+00,  1.0365239329446050e+00,  1.0361531226427443e+00,
    1.0348785007827348e+00,  1.0042729660717318e+00,  8.4218486432354278e-01,
    7.3759394894801567e-01,  6.5853154500294642e-01,  6.0531682444066282e-01,
    5.9549794132420741e-01,  5.9419261278443136e-01,  5.6517682326634266e-01,
    5.6061186014968556e-01,  5.8228610381018719e-01};

const Float RGBIllum2SpectRed[nRGB2SpectSamples] = {
    5.4711187157291841e-02,  5.5609066498303397e-02,  6.0755873790918236e-02,
    5.6232948615962369e-02,  4.6169940535708678e-02,  3.8012808167818095e-02,
    2.4424225756670338e-02,  3.8983580581592181e-03,  -5.6082252172734437e-04,
    9.6493871255194652e-04,  3.7341198051510371e-04,  -4.3367389093135200e-04,
    -9.3533962256892034e-05, -1.2354967412842033e-04, -1.4524548081687461e-04,
    -2.0047691915543731e-04, -4.9938587694693670e-04, 2.7255083540032476e-02,
    1.6067405906297061e-01,  3.5069788873150953e-01,  5.7357465538418961e-01,
    7.6392091890718949e-01,  8.9144466740381523e-01,  9.6394609909574891e-01,
    9.8879464276016282e-01,  9.9897449966227203e-01,  9.8605140403564162e-01,
    9.9532502805345202e-01,  9.7433478377305371e-01,  9.9134364616871407e-01,
    9.8866287772174755e-01,  9.9713856089735531e-01};

const Float RGBIllum2SpectGreen[nRGB2SpectSamples] = {
    2.5168388755514630e-02,  3.9427438169423720e-02,  6.2059571596425793e-03,
    7.1120859807429554e-03,  2.1760044649139429e-04,  7.3271839984290210e-12,
    -2.1623066217181700e-02, 1.5670209409407512e-02,  2.8019603188636222e-03,
    3.2494773799897647e-01,  1.0164917292316602e+00,  1.0329476657890369e+00,
    1.0321586962991549e+00,  1.0358667411948619e+00,  1.0151235476834941e+00,
    1.0338076690093119e+00,  1.0371372378155013e+00,  1.0361377027692558e+00,
    1.0229822432557210e+00,  9.6910327335652324e-01,  -5.1785923899878572e-03,
    1.1131261971061429e-03,  6.6675503033011771e-03,  7.4024315686001957e-04,
    2.1591567633473925e-02,  5.1481620056217231e-03,  1.4561928645728216e-03,
    1.6414511045291513e-04,  -6.4630764968453287e-03, 1.0250854718507939e-02,
    4.2387394733956134e-02,  2.1252716926861620e-02};

const Float RGBIllum2SpectBlue[nRGB2SpectSamples] = {
    1.0570490759328752e+00,  1.0538466912851301e+00,  1.0550494258140670e+00,
    1.0530407754701832e+00,  1.0579930596460185e+00,  1.0578439494812371e+00,
    1.0583132387180239e+00,  1.0579712943137616e+00,  1.0561884233578465e+00,
    1.0571399285426490e+00,  1.0425795187752152e+00,  3.2603084374056102e-01,
    -1.9255628442412243e-03, -1.2959221137046478e-03, -1.4357356276938696e-03,
    -1.2963697250337886e-03, -1.9227081162373899e-03, 1.2621152526221778e-03,
    -1.6095249003578276e-03, -1.3029983817879568e-03, -1.7666600873954916e-03,
    -1.2325281140280050e-03, 1.0316809673254932e-02,  3.1284512648354357e-02,
    8.8773879881746481e-02,  1.3873621740236541e-01,  1.5535067531939065e-01,
    1.4878477178237029e-01,  1.6624255403475907e-01,  1.6997613960634927e-01,
    1.5769743995852967e-01,  1.9069090525482305e-01};

// Given a piecewise-linear SPD with values in vIn[] at corresponding
// wavelengths lambdaIn[], where lambdaIn is assumed to be sorted but may
// be irregularly spaced, resample the spectrum over the range of
// wavelengths [lambdaMin, lambdaMax], with a total of nOut wavelength
// samples between lambdaMin and lamdbaMax (including those at
// endpoints). The resampled spectrum values are written to vOut.
//
// In general, this is a standard sampling and reconstruction problem, with
// the complication that for any given invocation, some of the
// reconstruction points may involve upsampling the input distribution and
// others may involve downsampling. For upsampling, we just point-sample,
// and for downsampling, we apply a box filter centered around the
// destination wavelength with total width equal to the sample spacing.
void ResampleLinearSpectrum(const Float *lambdaIn, const Float *vIn, int nIn,
                            Float lambdaMin, Float lambdaMax, int nOut,
                            Float *vOut) {
    CHECK_GE(nOut, 2);
    for (int i = 0; i < nIn - 1; ++i) CHECK_GT(lambdaIn[i + 1], lambdaIn[i]);
    CHECK_LT(lambdaMin, lambdaMax);

    // Spacing between samples in the output distribution.
    Float delta = (lambdaMax - lambdaMin) / (nOut - 1);

    // We assume that the SPD is constant outside of the specified
    // wavelength range, taking on the respectively first/last SPD value
    // for out-of-range wavelengths.
    //
    // To make this convention fit cleanly into the code below, we create
    // virtual samples in the input distribution with index -1 for the
    // sample before the first valid sample and index nIn for the sample
    // after the last valid sample. In turn, can place those virtual
    // samples beyond the endpoints of the target range so that we can
    // always assume that the source range is broader than the target
    // range, which in turn lets us not worry about various boundary cases
    // below.

    // The wavelengths of the virtual samples at the endpoints are set so
    // that they are one destination sample spacing beyond the destination
    // endpoints.  (Note that this potentially means that if we swept along
    // indices from -1 to nIn, we wouldn't always see a monotonically
    // increasing set of wavelength values. However, this isn't a problem
    // since we only access these virtual samples if the destination range
    // is wider than the source range.)
    auto lambdaInClamped = [&](int index) {
        CHECK(index >= -1 && index <= nIn);
        if (index == -1) {
            CHECK_LT(lambdaMin - delta, lambdaIn[0]);
            return lambdaMin - delta;
        } else if (index == nIn) {
            CHECK_GT(lambdaMax + delta, lambdaIn[nIn - 1]);
            return lambdaMax + delta;
        }
        return lambdaIn[index];
    };

    // Due to the piecewise-constant assumption, the SPD values outside the
    // specified range are given by the valid endpoints.
    auto vInClamped = [&](int index) {
        CHECK(index >= -1 && index <= nIn);
        return vIn[Clamp(index, 0, nIn - 1)];
    };

    // Helper that upsamples ors downsample the given SPD at the given
    // wavelength lambda.
    auto resample = [&](Float lambda) -> Float {
        // Handle the edge cases first so that we don't need to worry about
        // them in the following.
        //
        // First, if the entire filtering range for the destination is
        // outside of the range of valid samples, we can just return the
        // endpoint value.
        if (lambda + delta / 2 <= lambdaIn[0]) return vIn[0];
        if (lambda - delta / 2 >= lambdaIn[nIn - 1]) return vIn[nIn - 1];
        // Second, if there's only one sample, then the SPD has the same
        // value everywhere, and we're done.
        if (nIn == 1) return vIn[0];

        // Otherwise, find indices into the input SPD that bracket the
        // wavelength range [lambda-delta, lambda+delta]. Note that this is
        // a 2x wider range than we will actually filter over in the end.
        int start, end;
        if (lambda - delta < lambdaIn[0])
            // Virtual sample at the start, as described above.
            start = -1;
        else {
            start = FindInterval(
                nIn, [&](int i) { return lambdaIn[i] <= lambda - delta; });
            CHECK(start >= 0 && start < nIn);
        }

        if (lambda + delta > lambdaIn[nIn - 1])
            // Virtual sample at the end, as described above.
            end = nIn;
        else {
            // Linear search from the starting point. (Presumably more
            // efficient than a binary search from scratch, or doesn't
            // matter either way.)
            end = start;
            while (end < nIn && lambda + delta > lambdaIn[end]) ++end;
        }

        if (end - start == 2 && lambdaInClamped(start) <= lambda - delta &&
            lambdaIn[start + 1] == lambda &&
            lambdaInClamped(end) >= lambda + delta) {
            // Downsampling: special case where the input and output
            // wavelengths line up perfectly, so just return the
            // corresponding point sample at lambda.
            return vIn[start + 1];
        } else if (end - start == 1) {
            // Downsampling: evaluate the piecewise-linear function at
            // lambda.
            Float t = (lambda - lambdaInClamped(start)) /
                      (lambdaInClamped(end) - lambdaInClamped(start));
            CHECK(t >= 0 && t <= 1);
            return Lerp(t, vInClamped(start), vInClamped(end));
        } else {
            // Upsampling: use a box filter and average all values in the
            // input spectrum from lambda +/- delta / 2.
            return AverageSpectrumSamples(
                lambdaIn, vIn, nIn, lambda - delta / 2, lambda + delta / 2);
        }
    };

    // For each destination sample, compute the wavelength lambda for the
    // sample and then resample the source SPD distribution at that point.
    for (int outOffset = 0; outOffset < nOut; ++outOffset) {
        // TODO: Currently, resample() does a binary search each time,
        // even though we could do a single sweep across the input array,
        // since we're resampling it at a regular and increasing set of
        // lambdas. It would be nice to polish that up.
        Float lambda =
            Lerp(Float(outOffset) / (nOut - 1), lambdaMin, lambdaMax);
        vOut[outOffset] = resample(lambda);
    }
}

}  // namespace pbrt
